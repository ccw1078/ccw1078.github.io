

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="ccw">
  <meta name="keywords" content="">
  
    <meta name="description" content="什么是生成式人工智能 生成式人工智能简介 传统的机器学习主要是预测式的（例如预测天气、房价、检测目标位置等），或者分析式的（例如对数据进行分类、标注等）。LLM 大语言模型则有所不同，它是生成式的，能够合成新数据，而不再局限于决策或预测。因此它在文本、图像、音乐和视频等需要生成内容的领域得到广泛使用。 2022 年后，人们发现可以通过提供示范和反馈，即使用提示词工程，显著提升模型的表现。  随着模">
<meta property="og:type" content="article">
<meta property="og:title" content="LangChain 大模型应用开发">
<meta property="og:url" content="https://ccw1078.github.io/2025/11/08/LangChain%20%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/index.html">
<meta property="og:site_name" content="Ccw&#39;s Blogs">
<meta property="og:description" content="什么是生成式人工智能 生成式人工智能简介 传统的机器学习主要是预测式的（例如预测天气、房价、检测目标位置等），或者分析式的（例如对数据进行分类、标注等）。LLM 大语言模型则有所不同，它是生成式的，能够合成新数据，而不再局限于决策或预测。因此它在文本、图像、音乐和视频等需要生成内容的领域得到广泛使用。 2022 年后，人们发现可以通过提供示范和反馈，即使用提示词工程，显著提升模型的表现。  随着模">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251113171038.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251113171106.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251113171130.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251114112746.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251114112818.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251116195408.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251117180338.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202511291123724.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202511291133723.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202512012045787.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202512012120472.png">
<meta property="og:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202512012123649.png">
<meta property="article:published_time" content="2025-11-07T23:18:00.000Z">
<meta property="article:modified_time" content="2025-12-09T06:58:19.295Z">
<meta property="article:author" content="ccw">
<meta property="article:tag" content="人工智能">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251113171038.png">
  
  
  
  <title>LangChain 大模型应用开发 - Ccw&#39;s Blogs</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"ccw1078.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Ccw's Blogs" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ccw&#39;s blogs</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="LangChain 大模型应用开发"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-11-08 07:18" pubdate>
          2025年11月8日 早上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          21k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          175 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">LangChain 大模型应用开发</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="%E4%BB%80%E4%B9%88%E6%98%AF%E7%94%9F%E6%88%90%E5%BC%8F%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD" tabindex="-1">什么是生成式人工智能</h1>
<h2 id="%E7%94%9F%E6%88%90%E5%BC%8F%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%AE%80%E4%BB%8B" tabindex="-1" id="生成式人工智能简介">生成式人工智能简介</h2>
<p>传统的机器学习主要是预测式的（例如预测天气、房价、检测目标位置等），或者分析式的（例如对数据进行分类、标注等）。LLM 大语言模型则有所不同，它是生成式的，能够合成新数据，而不再局限于决策或预测。因此它在文本、图像、音乐和视频等需要生成内容的领域得到广泛使用。</p>
<p>2022 年后，人们发现可以通过提供示范和反馈，即使用提示词工程，显著提升模型的表现。</p>
<blockquote>
<p>随着模型参数量的不断增加，例如 20-70 亿个参数，模型开始表现出新的能力，即能够生成创意型的新内容，并能够提供丰富的信息来回答一些开放性和挑战性的问题。</p>
</blockquote>
<h2 id="%E4%BA%86%E8%A7%A3%E5%A4%A7%E8%A7%84%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B" tabindex="-1" id="了解大规模语言模型">了解大规模语言模型</h2>
<blockquote>
<p>表征学习：模型不会被明确的指示要学习哪些特征，而是根据原始数据，自己找出那些重要的特征。</p>
</blockquote>
<p>目前模型在处理数学或复杂的推理任务时，结果表现不佳。而且，我们还无法确定，通过不断增加参数规模，是否一定能够克服这个障碍。对于复杂和严谨的推理任务来说，正确的答案有可能在现有经验之外。而大模型的训练是基于过往提供的数据，推测一个可能性的最大答案，因此该答案一般是现有经验范围之内。</p>
<h2 id="%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E6%9C%AC%E5%88%B0%E5%9B%BE%E5%83%8F%E6%A8%A1%E5%9E%8B" tabindex="-1" id="什么是文本到图像模型">什么是文本到图像模型</h2>
<p>有几种文生图的模型类型，其优缺点分别如下：</p>
<table>
<thead>
<tr>
<th>模型类型</th>
<th>图像质量</th>
<th>文本对齐</th>
<th>推理速度</th>
<th>训练难度</th>
<th>典型代表</th>
</tr>
</thead>
<tbody>
<tr>
<td>GAN</td>
<td>高</td>
<td>中</td>
<td>快</td>
<td>高</td>
<td>AttnGAN, StyleGAN+CLIP</td>
</tr>
<tr>
<td>VAE</td>
<td>低~中</td>
<td>弱</td>
<td>快</td>
<td>低</td>
<td>VQ-VAE（组件）</td>
</tr>
<tr>
<td>自回归</td>
<td>高</td>
<td>强</td>
<td>慢</td>
<td>极高</td>
<td>DALL·E, Parti</td>
</tr>
<tr>
<td>扩散模型</td>
<td>极高</td>
<td>强~极强</td>
<td>中~慢*</td>
<td>极高</td>
<td>Stable Diffusion, Imagen</td>
</tr>
<tr>
<td>混合/新兴</td>
<td>极高</td>
<td>极强</td>
<td>中</td>
<td>高</td>
<td>FLUX.1, Ideogram</td>
</tr>
</tbody>
</table>
<blockquote>
<p>*注：扩散模型可通过蒸馏、Few-step采样（如DDIM、LCM）显著加速。</p>
</blockquote>
<p>扩散模型的实现过程貌似跟人类的作图过程有点类似，先从一张白纸开始（随机噪声），然后先画个轮廓，之后不断细化添加更细节，直至和脑海中想要的结果对齐（对于模型来说则是与输入的文字对齐）。</p>
<h2 id="%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%9C%A8%E5%85%B6%E4%BB%96%E9%A2%86%E5%9F%9F%E7%9A%84%E4%BD%9C%E7%94%A8" tabindex="-1" id="人工智能在其他领域的作用">人工智能在其他领域的作用</h2>
<p>文本、图像、音频、视频、结构化数据，这些数据类型都可以通过大模型来实现从 A 类型到 B 类型的生成。</p>
<table>
<thead>
<tr>
<th>输入 \输出类型</th>
<th>文本</th>
<th>图像</th>
<th>音频</th>
<th>视频</th>
<th>结构化数据（如表格、代码等）</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>文本</strong></td>
<td>- 语言模型（如 GPT 系列）<br>- 问答系统<br>- 文本摘要<br>- 机器翻译</td>
<td>- 文生图模型（如 DALL·E、Stable Diffusion）</td>
<td>- 文本转语音（TTS，如 Tacotron、VITS）</td>
<td>- 文本生成视频（如 Sora、Phenaki）</td>
<td>- 文本生成代码（如 Codex、CodeLlama）<br>- 文本生成结构化数据（如 JSON、SQL）</td>
</tr>
<tr>
<td><strong>图像</strong></td>
<td>- 图像描述生成（Image Captioning）<br>- OCR + 语义理解</td>
<td>- 图像编辑/增强<br>- 图像超分辨率<br>- 图像到图像翻译（如 Pix2Pix）</td>
<td>- 图像驱动语音合成（较少见）</td>
<td>- 图像插帧/视频预测<br>- 单图生成视频（如 Make-A-Video）</td>
<td>- 图像内容结构化（如图表识别、表格提取）</td>
</tr>
<tr>
<td><strong>音频</strong></td>
<td>- 语音识别（ASR，如 Whisper）<br>- 音频内容摘要</td>
<td>- 声音可视化（如声谱图生成图像，较少主流应用）</td>
<td>- 语音转换（Voice Conversion）<br>- 音频修复/增强</td>
<td>- 音频驱动视频生成（如 talking head 模型）</td>
<td>- 音频转结构化信息（如音乐转 MIDI、语音转命令）</td>
</tr>
<tr>
<td><strong>视频</strong></td>
<td>- 视频描述生成（Video Captioning）<br>- 视频问答</td>
<td>- 视频风格迁移<br>- 视频超分辨率<br>- 视频编辑</td>
<td>- 视频中语音提取与合成</td>
<td>- 视频预测/补全<br>- 视频重生成</td>
<td>- 视频行为识别结果<br>- 视频内容结构化标注</td>
</tr>
<tr>
<td><strong>结构化数据</strong></td>
<td>- 数据解释/自然语言描述（如 NL2SQL 的反向）</td>
<td>- 表格/数据可视化生成</td>
<td>- 数据驱动语音播报</td>
<td>- 数据驱动动画/演示生成</td>
<td>- 数据清洗/转换<br>- 数据补全/预测（如时间序列模型）</td>
</tr>
</tbody>
</table>
<h1 id="%E9%9D%A2%E5%90%91%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" tabindex="-1">面向大模型的应用程序</h1>
<h2 id="%E8%B6%85%E8%B6%8A%E9%9A%8F%E6%9C%BA%E9%B9%A6%E9%B9%89" tabindex="-1" id="超越随机鹦鹉">超越随机鹦鹉</h2>
<p>鹦鹉能够模仿人类说话，听起来就像真的一样，但鹦鹉本身并不理解这些话的意思。这也是大语言模型目前面临的困境，它并不真正的理解内容本身，因此它在一些复杂的逻辑推理和数学计算场景表现不佳。</p>
<p>缓解大模型局限性的一些方法：</p>
<ul>
<li>提示词工程和微调：有针对性的训练数据让大模型更契合特定业务场景，结构性的提示词引导模型输出预期结果；</li>
<li>自我任务提示：有助于将复杂的问题拆分成多个小问题进行解决；</li>
<li>连接外部数据：避免训练数据过时的问题；</li>
<li>过滤和监控：对模型的输出进行过滤和调整，及时纠结小错误；</li>
</ul>
<h2 id="langchain-%E7%AE%80%E4%BB%8B" tabindex="-1" id="LangChain-简介">LangChain 简介</h2>
<p>LangChain 通过提供合理的抽象，让开发大模型应用变得简单和灵活。其核心功能包括：</p>
<ul>
<li>组件模块化：各模块可进行自由组合、替换、复用，从而更加易读和维护；</li>
<li>与外部服务进行连接；</li>
<li>实现智能体间的交互，取代孤立的 API 调用；</li>
<li>实现记忆和数据的持久性；</li>
</ul>
<p>相关生态：</p>
<ul>
<li>LangSmith：提供应用的测试、调试和监控功能；</li>
<li>LangChain 模板：模板仓库，方便开发人员复用，避免重复造轮子；</li>
<li>LangServe：方便部署和管理开发好的应用；</li>
<li>LangGraph：帮忙开发循环数据流和多角色互动的应用；</li>
</ul>
<h2 id="%E6%8E%A2%E7%B4%A2-langchain-%E7%9A%84%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6" tabindex="-1" id="探索-LangChain-的关键组件">探索 LangChain 的关键组件</h2>
<h3 id="%E9%93%BE" tabindex="-1" id="链">链</h3>
<p>功能：将不同模块，组合成一个可以复用的管道（类似流水线），以实现特定的功能；例如：</p>
<ul>
<li>LLMMath：实现数学相关查询</li>
<li>SQLDatabaseChain：数据库查询；</li>
<li>LLMCheckerChain：对输入进行验证；</li>
<li>RouterChain：根据输入判断应使用哪种工具；</li>
</ul>
<h3 id="%E6%99%BA%E8%83%BD%E4%BD%93" tabindex="-1" id="智能体">智能体</h3>
<p>链是多个模块的组合，智能体则是多个链的组合；</p>
<p>在智能体中，大模型可用来帮助完成推理任务。模型会收到提示词、可用工具、历史信息等内容，然后模型选择下一步的动作，可能是使用某个工具，也可能是给出最终的响应。</p>
<blockquote>
<p>由于模型需要判断是否使用工具以及使用哪个工具，因此工具必须包括功能描述，以便模型进行判断。</p>
</blockquote>
<h3 id="%E8%AE%B0%E5%BF%86" tabindex="-1" id="记忆">记忆</h3>
<p>智能体和链是无状态的，Memory 则用来保存每次执行之间的状态。</p>
<p>部分常见的记忆选项：</p>
<ul>
<li>ConversationBufferMemory：在模型历史中存储所有消息</li>
<li>ConversationBufferWindowMemory：只保留最近的几条消息</li>
<li>ConversationKGMemory：将交流总结为知识图谱，并集成到提示中；</li>
<li>ConversationEntityMemory：存储对话中的一些事实；</li>
</ul>
<p>另外也可以连接多种数据库，实现持久化存储；</p>
<h3 id="%E5%B7%A5%E5%85%B7" tabindex="-1" id="工具">工具</h3>
<p>工具可帮助智能体实现特定的功能，例如内置的文档加载器、向量存储等；</p>
<p>部分常见的工具：</p>
<ul>
<li>机器翻译；</li>
<li>计算器；</li>
<li>地图查询；</li>
<li>股票查询；</li>
<li>天气查询；</li>
<li>幻灯片制作；</li>
<li>表格处理；</li>
<li>搜索引擎；</li>
<li>维基百科；</li>
<li>在线购物；</li>
<li>知识图谱：从知识库中查询提取相关信息；</li>
</ul>
<h2 id="langchain-%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C" tabindex="-1" id="LangChain-如何工作">LangChain 如何工作</h2>
<p>LangChain 封装了一系列组件，这些组件可相互协作，同时也可以自定义（只需实现统一的接口即可）。通过组件的共同协作完成复杂的任务。</p>
<p>主要组成部分包括：</p>
<ul>
<li>准备数据
<ul>
<li>文档加载器；</li>
<li>文本划分器；</li>
</ul>
</li>
<li>准备提示
<ul>
<li>基于用户的输入，代入模板，生成结构性的提示，引导模型生成预期结果；</li>
</ul>
</li>
<li>内容生成
<ul>
<li>由大模型负责完成；</li>
</ul>
</li>
<li>利用工具
<ul>
<li>检索信息；</li>
<li>调用工具完成特定任务；</li>
</ul>
</li>
<li>记忆
<ul>
<li>存储对话信息，以便保持上下文；</li>
</ul>
</li>
<li>监控
<ul>
<li>记录调用过程，以便进行调试和改进；</li>
</ul>
</li>
<li>整合：借助以下两个工具串联以上各部分内容
<ul>
<li>链</li>
<li>智能体</li>
</ul>
</li>
</ul>
<h2 id="langchain-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%BB%93%E6%9E%84" tabindex="-1" id="LangChain-软件包结构">LangChain 软件包结构</h2>
<p>主要划分如下：</p>
<ul>
<li>langchain-core：只包含基础组件的抽象和方法，以及几个核心组件，例如模型、向量存储、检索器等；</li>
<li>langchain：链、智能体、检索策略；</li>
<li>langchain-community：由社区维护的第三方集成；</li>
<li>合作伙伴各自的软件包</li>
</ul>
<h2 id="langchain-%E5%92%8C%E5%85%B6%E4%BB%96%E6%A1%86%E6%9E%B6%E6%AF%94%E8%BE%83" tabindex="-1" id="LangChain-和其他框架比较">LangChain 和其他框架比较</h2>
<table>
<thead>
<tr>
<th>工具</th>
<th>开发者</th>
<th>类型</th>
<th>主要用途</th>
<th>是否开源</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>AutoGen</strong></td>
<td>Microsoft</td>
<td>框架</td>
<td>多智能体协作系统构建</td>
<td>✅ 开源（MIT）</td>
</tr>
<tr>
<td><strong>MetaGPT</strong></td>
<td>OpenBMB / 社区</td>
<td>框架</td>
<td>基于角色的多智能体软件工程自动化</td>
<td>✅ 开源（Apache 2.0）</td>
</tr>
<tr>
<td><strong>LangChain</strong></td>
<td>LangChain Inc.</td>
<td>框架</td>
<td>构建 LLM 驱动的应用（链式调用、记忆、工具集成等）</td>
<td>✅ 开源（MIT）</td>
</tr>
<tr>
<td><strong>LlamaIndex</strong></td>
<td>LlamaIndex Inc.</td>
<td>框架</td>
<td>数据连接与检索增强生成（RAG）</td>
<td>✅ 开源（MIT）</td>
</tr>
<tr>
<td><strong>Dify</strong></td>
<td><a target="_blank" rel="noopener" href="http://Dify.AI">Dify.AI</a></td>
<td>平台（低代码+API）</td>
<td>快速构建 AI 应用（支持 Agent、RAG、Workflow）</td>
<td>✅ 开源（部分）+ 商业版</td>
</tr>
<tr>
<td><strong>Coze</strong></td>
<td>字节跳动</td>
<td>平台（无代码/低代码）</td>
<td>构建聊天机器人、插件、工作流（面向 C 端和 B 端）</td>
<td>❌ 闭源（SaaS 平台）</td>
</tr>
</tbody>
</table>
<h1 id="langchain-%E5%85%A5%E9%97%A8" tabindex="-1">LangChain 入门</h1>
<h2 id="%E8%AE%BE%E7%BD%AE%E4%BE%9D%E8%B5%96" tabindex="-1" id="设置依赖">设置依赖</h2>
<p>开发环境适合用 conda，生产环境适合用 docker</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>pip</th>
<th>Poetry</th>
<th>Conda</th>
<th>Docker</th>
</tr>
</thead>
<tbody>
<tr>
<td>主要用途</td>
<td>安装 Python 包</td>
<td>依赖+项目管理</td>
<td>包+环境管理</td>
<td>应用容器化</td>
</tr>
<tr>
<td>环境隔离</td>
<td>❌（需 venv）</td>
<td>✅（自动）</td>
<td>✅</td>
<td>✅（操作系统级）</td>
</tr>
<tr>
<td>依赖解析能力</td>
<td>弱</td>
<td>强</td>
<td>强（含二进制）</td>
<td>依赖内部工具（如 pip）</td>
</tr>
<tr>
<td>锁文件支持</td>
<td>❌（需扩展）</td>
<td>✅（poetry.lock）</td>
<td>✅（environment.yml + explicit）</td>
<td>❌（但可通过固定版本实现）</td>
</tr>
<tr>
<td>支持非 Python 依赖</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
<td>✅（通过系统安装）</td>
</tr>
<tr>
<td>适合数据科学</td>
<td>一般</td>
<td>一般</td>
<td>✅</td>
<td>✅（配合 Conda/pip）</td>
</tr>
<tr>
<td>适合生产部署</td>
<td>❌</td>
<td>⚠️（需打包）</td>
<td>⚠️</td>
<td>✅</td>
</tr>
<tr>
<td>学习成本</td>
<td>低</td>
<td>中</td>
<td>中</td>
<td>高</td>
</tr>
</tbody>
</table>
<h2 id="%E9%9B%86%E6%88%90%E6%A8%A1%E5%9E%8B" tabindex="-1" id="集成模型">集成模型</h2>
<p>在环境变量中配置 API KEY 即可；</p>
<h2 id="%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%BA%A4%E4%BA%92" tabindex="-1" id="大模型交互">大模型交互</h2>
<h3 id="%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B" tabindex="-1" id="大语言模型">大语言模型</h3>
<p>各家模型提供了相应的软件包来初始化模型，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> langchain_google_genai <span class="hljs-keyword">import</span> GoogleGenerativeAI<br><span class="hljs-keyword">from</span> langchain_community.chat_models <span class="hljs-keyword">import</span> ChatTongyi<br><br><span class="hljs-comment"># Gemini</span><br>gemini_pro = GoogleGenerativeAI(model=<span class="hljs-string">&quot;gemini-2.0-flash&quot;</span>)<br><br><span class="hljs-comment"># OpenAI</span><br>openai_llm = OpenAI()<br><br><span class="hljs-comment"># 通义千问</span><br>qwen_llm = ChatTongyi(model_name=<span class="hljs-string">&quot;qwen-turbo&quot;</span>, temperature=<span class="hljs-number">0.7</span>)<br><br><span class="hljs-comment"># 不管哪个模型，方法是相同的，例如都有 invoke 方法</span><br>response = gemini_pro.invoke(<span class="hljs-string">&quot;Tell me a joke about light bulbs!&quot;</span>)<br><span class="hljs-built_in">print</span>(response)<br></code></pre></td></tr></table></figure>
<h3 id="%E6%A8%A1%E6%8B%9F%E5%A4%A7%E6%A8%A1%E5%9E%8B" tabindex="-1" id="模拟大模型">模拟大模型</h3>
<p>在开发应用时，对模型的调用不一定要使用真实的 API 接口，也可以返回模拟的响应结果。这样的好处是让结果更稳定，二来响应速度更快，也更省钱；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_community.llms <span class="hljs-keyword">import</span> FakeListLLM<br><br><span class="hljs-comment"># 创建一个虚拟的 LLM，总是返回固定的响应结果</span><br>fake_llm = FakeListLLM(responses=[<span class="hljs-string">&quot;Hello&quot;</span>])<br><br>result = fake_llm.invoke(<span class="hljs-string">&quot;Any input will return Hello&quot;</span>)<br><span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># Output: Hello</span><br></code></pre></td></tr></table></figure>
<h3 id="%E8%81%8A%E5%A4%A9%E6%A8%A1%E5%9E%8B" tabindex="-1" id="聊天模型">聊天模型</h3>
<p>Langchain 为聊天对话设计了结构化的形式，以便区分不同角色的发言内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_anthropic <span class="hljs-keyword">import</span> ChatAnthropic<br><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> SystemMessage, HumanMessage<br><br>chat = ChatAnthropic(model=<span class="hljs-string">&quot;claude-3-opus-20240229&quot;</span>)<br><br><span class="hljs-comment"># 整合多条消息，区分不同角色</span><br>messages = [<br>    SystemMessage(content=<span class="hljs-string">&quot;You&#x27;re a helpful programming assistant&quot;</span>),<br>    HumanMessage(content=<span class="hljs-string">&quot;Write a Python function to calculate factorial&quot;</span>)<br>]<br>response = chat.invoke(messages)<br></code></pre></td></tr></table></figure>
<h3 id="%E6%8F%90%E7%A4%BA%E8%AF%8D" tabindex="-1" id="提示词">提示词</h3>
<p>LangChain 支持提示词模板，可在模板中使用占位符变量，实际调用时，动态的替换变量内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate<br><span class="hljs-keyword">from</span> langchain_google_genai <span class="hljs-keyword">import</span> GoogleGenerativeAI<br><br><span class="hljs-comment"># 编写模板内容，设置变量 text</span><br>template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Summarize this text in one sentence:</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;text&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>llm = GoogleGenerativeAI(model=<span class="hljs-string">&quot;gemini-1.5-pro&quot;</span>)<br><br><span class="hljs-comment"># 初始化提示词模板</span><br>prompt = PromptTemplate.from_template(template)<br><br><span class="hljs-comment"># 传入 text 变量内容，生成最终提示词</span><br>formatted_prompt = prompt.<span class="hljs-built_in">format</span>(text=<span class="hljs-string">&quot;Some long story about AI...&quot;</span>)<br><br><span class="hljs-comment"># 调用模型</span><br>result = llm.invoke(formatted_prompt)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><br>template = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;You are an English to French translator.&quot;</span>),<br>    (<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;Translate this to French: &#123;text&#125;&quot;</span>)  <span class="hljs-comment"># 此处 text 可动态替换</span><br>])<br><br>chat = ChatOpenAI()<br>formatted_messages = template.format_messages(text=<span class="hljs-string">&quot;Hello, how are you?&quot;</span>)<br>result = chat.invoke(formatted_messages)<br><span class="hljs-built_in">print</span>(result.content)<br></code></pre></td></tr></table></figure>
<h3 id="%E9%93%BE%E5%92%8C-lcel-%E8%A1%A8%E8%BE%BE%E5%BC%8F" tabindex="-1" id="链和-LCEL-表达式">链和 LCEL 表达式</h3>
<p>使用链将多个动作串联起来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><br><span class="hljs-comment"># 创建模板</span><br>prompt = PromptTemplate.from_template(<span class="hljs-string">&quot;Tell me a joke about &#123;topic&#125;&quot;</span>)<br>llm = ChatOpenAI()<br>output_parser = StrOutputParser()<br><br><span class="hljs-comment"># 串联多个动作, 返回一个链对象</span><br>chain = prompt | llm | output_parser<br><br><span class="hljs-comment"># 链对象也有 invoke 方法</span><br>result = chain.invoke(&#123;<span class="hljs-string">&quot;topic&quot;</span>: <span class="hljs-string">&quot;programming&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>
<h3 id="%E6%96%87%E6%9C%AC%E5%88%B0%E5%9B%BE%E5%83%8F" tabindex="-1" id="文本到图像">文本到图像</h3>
<p>可先使用文本 LLM 将用户输入的文本进行扩充，补充更丰富的细节信息。之后再提交给图像 LLM 生成图片。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt = PromptTemplate(<br>	input_variables=[<span class="hljs-string">&quot;image_desc&quot;</span>],<br>    template=(<br>    	<span class="hljs-string">&quot;Generate a concise prompt to generate an image based on the following description:&quot;</span><br>        <span class="hljs-string">&quot;&#123;image_desc&#125;&quot;</span><br>    )<br>)<br>chain = LLMChain(llm=llm, prompt=prompt)<br><br>image_url = DallEAPIWrapper().run(<br>    <span class="hljs-comment"># 先用 LLM 完善图片细节</span><br>    chain.run(<span class="hljs-string">&quot;halloween night at a haunted museum&quot;</span>)<br>)<br></code></pre></td></tr></table></figure>
<h3 id="replicate" tabindex="-1" id="Replicate">Replicate</h3>
<p>Replicate 是一个可以部署大模型的云平台，LangChain 已经封装了 API，可以很方便的调用已经部署好的模型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_community.llms <span class="hljs-keyword">import</span> Replicate<br><br>llm = Replicate(<br>    model=<span class="hljs-string">&quot;meta/llama-2-7b-chat:&lt;模型ID&gt;&quot;</span><br>    <span class="hljs-comment"># 完整模型版本ID 示例</span><br>    <span class="hljs-comment"># &quot;meta/llama-2-7b-chat:8e6975e5ed6174911a6ff3d60540dfd4844201974602551e10e9e87ab143d81e&quot;</span><br>)<br><br>response = llm.invoke(<span class="hljs-string">&quot;你好！介绍一下你自己。&quot;</span>)<br><span class="hljs-built_in">print</span>(response)<br></code></pre></td></tr></table></figure>
<h3 id="%E5%9B%BE%E5%83%8F%E7%90%86%E8%A7%A3" tabindex="-1" id="图像理解">图像理解</h3>
<p>有些模型是多模态的，能够理解用户上传的图片，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><br>chat = ChatOpenAI(model=<span class="hljs-string">&quot;gpt-4-turbo&quot;</span>, max_tokens=<span class="hljs-number">256</span>)<br>image_url = <span class="hljs-string">&quot;https://image_example_url&quot;</span><br><br>chat.invoke([<br>    HumanMessage(<br>    	content=[<br>            &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>, <br>                <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;What is this image showing&quot;</span><br>            &#125;,<br>            &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;image_url&quot;</span>,<br>                <span class="hljs-string">&quot;image_url&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;url&quot;</span>: image_url,<br>                    <span class="hljs-string">&quot;detail&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span><br>                &#125;<br>            &#125;<br>        ]<br>    )<br>])<br></code></pre></td></tr></table></figure>
<h2 id="%E8%BF%90%E8%A1%8C%E6%9C%AC%E5%9C%B0%E6%A8%A1%E5%9E%8B" tabindex="-1" id="运行本地模型">运行本地模型</h2>
<p>除了调用云端的模型 API，LangChain 也支持在本地运行模型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 方法一：调用运行在本地的模型，模型使用 Ollama 部署</span><br><span class="hljs-keyword">from</span> langchain_ollama <span class="hljs-keyword">import</span> ChatOllama<br><br>chat = ChatOllama(<br>    model=<span class="hljs-string">&quot;deepseek-r1:1.5b&quot;</span>,<br>    temperature=<span class="hljs-number">0</span>,<br>)<br><br>messages = [<br>    (<br>        <span class="hljs-string">&quot;system&quot;</span>,<br>        <span class="hljs-string">&quot;You are a helpful assistant.&quot;</span>,<br>    ),<br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;What makes LangChain great for working with LLMs?&quot;</span>),<br>]<br>ai_msg = chat.invoke(messages)<br><span class="hljs-built_in">print</span>(ai_msg.content)<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 方法二：从 HuggingFace 直接下载模型，并由 LangChain 运行</span><br><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> SystemMessage, HumanMessage<br><span class="hljs-keyword">from</span> langchain_huggingface <span class="hljs-keyword">import</span> ChatHuggingFace, HuggingFacePipeline<br><br><span class="hljs-comment"># 下载并运行模型</span><br>llm = HuggingFacePipeline.from_model_id(<br>    model_id=<span class="hljs-string">&quot;TinyLlama/TinyLlama-1.1B-Chat-v1.0&quot;</span>,<br>    task=<span class="hljs-string">&quot;text-generation&quot;</span>,<br>    pipeline_kwargs=<span class="hljs-built_in">dict</span>(<br>        max_new_tokens=<span class="hljs-number">512</span>,<br>        do_sample=<span class="hljs-literal">False</span>,<br>        repetition_penalty=<span class="hljs-number">1.03</span>,<br>    ),<br>)<br><br>chat_model = ChatHuggingFace(llm=llm)<br><br><span class="hljs-comment"># 初始化提示</span><br>messages = [<br>    SystemMessage(content=<span class="hljs-string">&quot;You&#x27;re a helpful assistant&quot;</span>),<br>    HumanMessage(<br>        content=<span class="hljs-string">&quot;Explain the concept of machine learning in simple terms&quot;</span><br>    ),<br>]<br>ai_msg = chat_model.invoke(messages)<br><span class="hljs-built_in">print</span>(ai_msg.content)<br></code></pre></td></tr></table></figure>
<h2 id="%E6%9E%84%E5%BB%BA%E5%AE%A2%E6%88%B7%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F" tabindex="-1" id="构建客户服务应用程序">构建客户服务应用程序</h2>
<p>客服类应用程序涉及以下一些功能：</p>
<ul>
<li>情感分类：识别客户的情绪；</li>
<li>生成摘要：抓取客户消息中的重点；</li>
<li>意图分类：理解客户想要达成的目标；</li>
<li>生成回复：根据历史回复数据和知识库，生成合适的回复；</li>
</ul>
<h4 id="map-reduce-%E6%96%B9%E6%B3%95" tabindex="-1" id="map-reduce-方法">map-reduce 方法</h4>
<p>有些文档比较大，可能超过了模型的输入限制。此时可使用 map-reduce 方法进行处理。map 方法将文档拆分成多个小段，每个小段的长度满足模型的输入限制。之后大模型可以并行处理这些小段，生成摘要。最后通过 reduce 方法合并摘要，生成最终的结果。</p>
<h1 id="%E6%9E%84%E5%BB%BA%E5%BE%97%E5%8A%9B%E5%8A%A9%E6%89%8B" tabindex="-1">构建得力助手</h1>
<h2 id="%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98" tabindex="-1" id="使用工具回答问题">使用工具回答问题</h2>
<h3 id="%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7" tabindex="-1" id="使用工具">使用工具</h3>
<p>工具由以下几部分构成：</p>
<ul>
<li>名称：str，必需</li>
<li>描述：str，必需，以便模型决定是否调用该函数；</li>
<li>函数：function，必需，执行的主体；</li>
<li>args_schema：Pydantic BaseModel，可选但推荐，有助于验证参数、少样本示例等；</li>
<li>返回方式：bool，是否将计算结果直接返回给用户</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 使用内置的工具 WikipediaQueryRun 示例</span><br><span class="hljs-keyword">from</span> langchain_community.tools <span class="hljs-keyword">import</span> WikipediaQueryRun<br><span class="hljs-keyword">from</span> langchain_community.utilities <span class="hljs-keyword">import</span> WikipediaAPIWrapper<br><br>api_wrapper = WikipediaAPIWrapper(top_k_results=<span class="hljs-number">1</span>, doc_content_chars_max=<span class="hljs-number">100</span>)<br><br>tool = WikipediaQueryRun(api_wrapper=api_wrapper)<br><br><span class="hljs-built_in">print</span>(tool.name)<br><span class="hljs-built_in">print</span>(tool.description)<br><span class="hljs-built_in">print</span>(tool.args)<br><span class="hljs-built_in">print</span>(tool.return_direct)<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">wikipedia<br>A wrapper around Wikipedia. Useful <span class="hljs-keyword">for</span> when you need to answer general questions about people, places, companies, facts, historical events, or other subjects. Input should be a search query.<br>&#123;<span class="hljs-string">&#x27;query&#x27;</span>: &#123;<span class="hljs-string">&#x27;description&#x27;</span>: <span class="hljs-string">&#x27;query to look up on wikipedia&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Query&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;string&#x27;</span>&#125;&#125;<br>False<br></code></pre></td></tr></table></figure>
<h3 id="%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7" tabindex="-1" id="自定义工具">自定义工具</h3>
<p>自定义工具的几种方法：</p>
<ul>
<li>@tool 装饰器</li>
<li>创建 BaseTool 子类</li>
<li>创建 StructuredTool 子类</li>
</ul>
<h3 id="%E5%B7%A5%E5%85%B7%E8%A3%85%E9%A5%B0%E5%99%A8" tabindex="-1" id="工具装饰器">工具装饰器</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool<br><br><span class="hljs-meta">@tool</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Searches things online.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> tool.run(querys=query)<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.pydantic_v1 <span class="hljs-keyword">import</span> BaseModel, Field<br><br><span class="hljs-comment"># pydantic 自动对数据进行校验、格式转换，有点类似 Nodejs 中的 Validator</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    <span class="hljs-comment"># Field 用于给字段 query 添加元信息，对字段进行描述，以便模型理解该字段</span><br>    query: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">&quot;The search query string.&quot;</span>) <br><br><span class="hljs-comment"># 使用 args_schema 表示模型调用工具前，需要提供指定结构的参数</span><br><span class="hljs-meta">@tool(<span class="hljs-params"><span class="hljs-string">&quot;search-tool&quot;</span>, args_schema=SearchInput, return_direct=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Searches things online.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;LangChain is awesome!&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="%E5%AD%90%E7%B1%BB%E5%8C%96-basetool" tabindex="-1" id="子类化-BaseTool">子类化 BaseTool</h3>
<p>子类化 BaseTool 能够更灵活的自定义工具，常用于以下场景：</p>
<ul>
<li>复杂的处理逻辑；</li>
<li>异步；</li>
<li>自定义异常处理；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 子类化 BaseTool 的示例，涉及定义：名称、描述、输入格式、同步或异步方法、异常处理等；</span><br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">Type</span><br><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> BaseTool<br><span class="hljs-keyword">from</span> langchain.callbacks.manager <span class="hljs-keyword">import</span> CallbackManagerForToolRun, AsyncCallbackManagerForToolRun<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    query: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">&quot;The search query string.&quot;</span>)<br>    <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomSearchTool</span>(<span class="hljs-title class_ inherited__">BaseTool</span>):<br>    name = <span class="hljs-string">&quot;custom-search-tool&quot;</span><br>    description = <span class="hljs-string">&quot;A tool that searches things online.&quot;</span><br>    args_schema: <span class="hljs-type">Type</span>[BaseModel] = SearchInput<br>    return_direct = <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_run</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        run_manager: <span class="hljs-type">Optional</span>[CallbackManagerForToolRun] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;use the tool synchronously.&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;LangChain is awesome!&quot;</span><br><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_arun</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">        run_manager: <span class="hljs-type">Optional</span>[AsyncCallbackManagerForToolRun] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;use the tool asynchronously.&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">raise</span> NotImplementedError(<span class="hljs-string">&quot;CustomSearchTool does not support async&quot;</span>)<br>    <br>search = CustomSearchTool()<br>search(query=<span class="hljs-string">&quot;What is LangChain?&quot;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="structuredtool-%E5%AF%B9%E8%B1%A1" tabindex="-1" id="StructuredTool-对象">StructuredTool 对象</h3>
<p>StructuredTool 比 BaseTool 简单，但同时又比 tool 装饰器更灵活一些，相当于折衷；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> StructuredTool<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_function</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Searches things online.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;LangChain is awesome!&quot;</span><br><br>search = StructuredTool.from_function(<br>    func=search_function,<br>    name=<span class="hljs-string">&quot;structured-search-tool&quot;</span>,<br>    description=<span class="hljs-string">&quot;A tool that searches things online.&quot;</span>,<br>    return_direct=<span class="hljs-literal">True</span>,<br>)<br>search(query=<span class="hljs-string">&quot;What is LangChain?&quot;</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CalcatorInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    a: <span class="hljs-built_in">int</span> = Field(description=<span class="hljs-string">&quot;The first number.&quot;</span>)<br>    b: <span class="hljs-built_in">int</span> = Field(description=<span class="hljs-string">&quot;The second number.&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Multiplies two numbers.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> a * b<br><br>calculator = StructuredTool.from_function(<br>    func=multiply,<br>    name=<span class="hljs-string">&quot;multiplier-tool&quot;</span>,<br>    description=<span class="hljs-string">&quot;A tool that multiplies two numbers.&quot;</span>,<br>    args_schema=CalcatorInput, <span class="hljs-comment"># 也可以自定义数据校验功能</span><br>    return_direct=<span class="hljs-literal">True</span>,<br>)<br>calculator(<span class="hljs-built_in">dict</span>(a=<span class="hljs-number">3</span>, b=<span class="hljs-number">5</span>))<br></code></pre></td></tr></table></figure>
<h3 id="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" tabindex="-1" id="错误处理">错误处理</h3>
<p>当工具在调用过程中出现异常时，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> ToolException<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search_function</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Searches things online.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> query:<br>        <span class="hljs-keyword">raise</span> ToolException(<span class="hljs-string">&quot;Query cannot be empty.&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;LangChain is awesome!&quot;</span><br><br>search = StructuredTool.from_function(<br>    func=search_function,<br>    name=<span class="hljs-string">&quot;structured-search-tool&quot;</span>,<br>    description=<span class="hljs-string">&quot;A tool that searches things online.&quot;</span>,<br>    return_direct=<span class="hljs-literal">True</span>,<br>    handle_tool_exception=<span class="hljs-literal">True</span>, <span class="hljs-comment"># 此处明确启用异常处理，当异常发生时，Tool 不会抛出异常，而是将异常封装为消息返回给调用者</span><br>)<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 另外也可以自定义异常处理逻辑，只需将 handle_tool_exception 设置为处理异常的函数即可</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_error_handler</span>(<span class="hljs-params">error: ToolException</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;[错误] 无法执行操作: <span class="hljs-subst">&#123;error.args[<span class="hljs-number">0</span>]&#125;</span>&quot;</span><br><br>multiply_tool = StructuredTool.from_function(<br>    func=multiply,<br>    name=<span class="hljs-string">&quot;Multiply&quot;</span>,<br>    description=<span class="hljs-string">&quot;将两个整数相乘&quot;</span>,<br>    args_schema=MultiplyInput,<br>    handle_tool_error=custom_error_handler  <span class="hljs-comment"># 传入自定义函数</span><br>)<br></code></pre></td></tr></table></figure>
<h2 id="%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E5%AE%9E%E7%8E%B0%E7%A0%94%E7%A9%B6%E5%8A%A9%E6%89%8B" tabindex="-1" id="使用工具实现研究助手">使用工具实现研究助手</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python">mport dashscope<br><span class="hljs-keyword">import</span> os<br><br>api_key = os.getenv(<span class="hljs-string">&quot;DASHSCOPE_API_KEY&quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> api_key:<br>    api_key = st.text_input(<span class="hljs-string">&quot;请输入你的 DashScope API Key（阿里云）&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;password&quot;</span>)<br><br><span class="hljs-keyword">if</span> api_key:<br>    dashscope.api_key = api_key<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;messages&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> st.session_state:<br>        st.session_state.messages = [&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;你是一个乐于助人的助手。&quot;</span>&#125;]<br><br>    <span class="hljs-comment"># 显示历史（跳过 system 消息）</span><br>    <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> st.session_state.messages:<br>        <span class="hljs-keyword">if</span> msg[<span class="hljs-string">&quot;role&quot;</span>] != <span class="hljs-string">&quot;system&quot;</span>:<br>            st.chat_message(msg[<span class="hljs-string">&quot;role&quot;</span>]).write(msg[<span class="hljs-string">&quot;content&quot;</span>])<br><br>    <span class="hljs-keyword">if</span> prompt := st.chat_input(<span class="hljs-string">&quot;请输入你的问题&quot;</span>):<br>        st.session_state.messages.append(&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;)<br>        st.chat_message(<span class="hljs-string">&quot;user&quot;</span>).write(prompt)<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_response</span>():<br>            messages = [HumanMessage(content=prompt)]<br>            <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> model.stream(messages):<br>                <span class="hljs-comment"># chunk 是 AIMessageChunk，取 content</span><br>                <span class="hljs-keyword">yield</span> chunk.content<br>                <br>        <span class="hljs-comment"># 流式输出</span><br>        <span class="hljs-keyword">with</span> st.chat_message(<span class="hljs-string">&quot;assistant&quot;</span>):<br>            response = st.write_stream(generate_response())<br><span class="hljs-keyword">else</span>:<br>    st.warning(<span class="hljs-string">&quot;请提供 DashScope API Key（可在阿里云控制台获取）&quot;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E7%AD%96%E7%95%A5" tabindex="-1" id="探索推理策略">探索推理策略</h2>
<p>大模型本身并不擅长复杂的符号推理，因此如果我们设计一个符号推理辅助的框架，将有助于模型完成一些更高级的复杂推理功能，例如：</p>
<ul>
<li>任务规划：将一个大任务拆分成多个小任务；</li>
<li>多步推理：从一系列收集到的事实信息中获得结论；</li>
<li>数学推理：进行符号变换求解方程；</li>
</ul>
<p>规划器（Planner）、执行器（Worker）、求解器（Solver）的协作示例：</p>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251113171038.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>有两种推理策略：</p>
<ul>
<li>
<p>方法一：依赖观察推理（零样本智能体）：模型做一个判断，工具执行，智能体将工具的执行结果做为新的信息，交给模型再次判断。重复这个循环，直到得出最终的结果。这个方法的优点是直观容易理解，缺点是随着循环次数增多，上下文会越来越大，成本很高。</p>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251113171106.png" srcset="/img/loading.gif" lazyload alt=""></p>
</li>
<li>
<p>方法二：不依赖观察推理，而是使用规划+求解（ReWOO，Reason without Observation）。规划器模型先规划任务，然后调用不同的工具来完成每一个规划的任务，收集信息。最终汇总规划列表和证据，统一让求解器模型生成最终的输出。其中规划器和求解器可以各自使用专用的模型，以获得更好的效果。</p>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251113171130.png" srcset="/img/loading.gif" lazyload alt=""></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Literal</span><br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> hub<br><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_react_agent, AgentExecutor<br><span class="hljs-keyword">from</span> langchain.chains.base <span class="hljs-keyword">import</span> Chain<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">from</span> langchain_experimental.plan_and_execute <span class="hljs-keyword">import</span> (<br>    PlanAndExecute, <span class="hljs-comment"># 内置了该推理策略</span><br>    load_agent_executor, <span class="hljs-comment"># 求解器</span><br>    load_chat_planner, <span class="hljs-comment"># 规划器</span><br>)<br><span class="hljs-keyword">from</span> langchain_community.tools <span class="hljs-keyword">import</span> load_tools<br><br>ReasoningStrategies = <span class="hljs-type">Literal</span>[<span class="hljs-string">&quot;zero-shot-react&quot;</span>, <span class="hljs-string">&quot;plan-and-execute&quot;</span>]<br><br> <span class="hljs-comment"># 支持两种不同推理策略</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_agent</span>(<span class="hljs-params">tool_names: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], strategy: ReasoningStrategies = <span class="hljs-string">&quot;zero-shot-react&quot;</span></span>) -&gt; Chain:<br>    <br>    llm = ChatOpenAI(temperature=<span class="hljs-number">0</span>, streaming=<span class="hljs-literal">True</span>)<br>    tools = load_tools(tool_names=tool_names, llm=llm)<br>    <br>    <span class="hljs-keyword">if</span> strategy == <span class="hljs-string">&quot;plan-and-execute&quot;</span>:<br>        planner = load_chat_planner(llm)<br>        executor = load_agent_executor(llm, tools, verbose=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">return</span> PlanAndExecute(planner=planner, executor=executor, verbose=<span class="hljs-literal">True</span>)<br>    <br>    prompt = hub.pull(<span class="hljs-string">&quot;hwchase17/react&quot;</span>)<br>    agent = create_react_agent(llm, tools, verbose=<span class="hljs-literal">True</span>, prompt=prompt)<br>    <span class="hljs-keyword">return</span> AgentExecutor(agent=agent, tools=tools)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>没有哪个策略是万能的，不同的策略有不同的使用场景。当使用场景不对时，不可避免会出现一些失败，例如步骤规划遗漏、语义理解错误、计算错误等；</p>
</blockquote>
<h2 id="%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%E7%BB%93%E6%9E%84%E5%8C%96%E4%BF%A1%E6%81%AF" tabindex="-1" id="从文件中读取结构化信息">从文件中读取结构化信息</h2>
<p>LangChain 内置的输出解析器，支持从文件中提取出结构化的信息，例如 PDF、CSV、XML、YAML 等；</p>
<blockquote>
<p>有时候大模型的信息提取并不完美，会遗漏一些信息。</p>
</blockquote>
<h2 id="%E9%80%9A%E8%BF%87%E4%BA%8B%E5%AE%9E%E6%A0%B8%E6%9F%A5%E5%87%8F%E5%B0%91%E5%B9%BB%E8%A7%89" tabindex="-1" id="通过事实核查减少幻觉">通过事实核查减少幻觉</h2>
<p>这个世界上充斥着各种虚假信息，如果大模型不加分辨的将它们做为自己的数据来源，其所得出的结论自然也是不真实的。为避免出现这种虚假的幻觉，有必要对信息进行核查。</p>
<p>核查的原理并不复杂，跟人类的行为类似，涉及以下三个动作：</p>
<ul>
<li>判断哪些信息需要核实；</li>
<li>搜集关于该信息的正反两方面的观点和数据；</li>
<li>整合以上信息，进行评估判断，得出结论；</li>
</ul>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251114112746.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>LangChain 有专门内置了一个链用来做事实核查的工作，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> LLMCheckerChain<br><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><br>llm = OpenAI(temperature=<span class="hljs-number">0</span>)<br>text = <span class="hljs-string">&quot;What type of mammal lays the biggest eggs?&quot;</span><br>checker_chain = LLMCheckerChain.from_llm(llm, verbose=<span class="hljs-literal">True</span>)<br>checker_chain.run(text)<br></code></pre></td></tr></table></figure>
<p>它背后的提示词设计大致如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 第1步：让模型罗列得出此结论背后的假设是什么</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Here&#x27;s the statement: &#123;statement&#125;</span><br><span class="hljs-string">Make a bullet point list of the assumptions you made when producing the above statement.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 第2步：根据模型返回的假设清单，逐一判断每一条假设是否正确</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Here is a bullet point list of assertings:</span><br><span class="hljs-string">&#123;assertions&#125;</span><br><span class="hljs-string">For each assertion, determine whether it is true or false. If it is false, explain why.</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 第3步：让模型综合以上信息，给出问题的最终回答</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">In light of the above facts, how would you answer the question</span><br><span class="hljs-string">&#123;question&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>以上 LLMChecker 提示词工程并不能保证最终的答案一定是正确的，它只是尽可能减少错误的概率。</p>
</blockquote>
<h1 id="%E6%9E%84%E5%BB%BA%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA" tabindex="-1">构建聊天机器人</h1>
<h2 id="%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA" tabindex="-1" id="什么是聊天机器人">什么是聊天机器人</h2>
<p>一些应用场景：</p>
<ul>
<li>个性化教育的虚拟导师；</li>
<li>法律问题咨询回复；</li>
<li>心理问题咨询回复；</li>
<li>在线购物售后客服；</li>
<li>医疗问题咨询回复；</li>
<li>虚拟助理：帮忙起草邮件、消息回复、提醒事项等；</li>
<li>招聘助理：自动筛选和分析简历；</li>
</ul>
<p>有两种聊天机器人，一种是被动型的，会话由用户主动发起，然后它进行回复，满足用户需求。还有一种是主动型的，它根据上下文预测用户的需求，然后主动发起会话，主动创造满足需求的机会。</p>
<h2 id="%E4%BB%8E%E5%90%91%E9%87%8F%E5%88%B0-rag" tabindex="-1" id="从向量到-RAG">从向量到 RAG</h2>
<h3 id="%E5%90%91%E9%87%8F%E5%B5%8C%E5%85%A5" tabindex="-1" id="向量嵌入">向量嵌入</h3>
<p>嵌入即向量化，将内容转换成用多维度的数字来表示。多维的数字有些类似空间的概念，通过计算点之间的距离，可以区别它们的相似性，甚至可以进行延伸，例如向量 king - man + woman 的值很接近 queen;</p>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251114112818.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="langchain-%E7%9A%84%E5%B5%8C%E5%85%A5" tabindex="-1" id="LangChain-的嵌入">LangChain 的嵌入</h3>
<p>LangChain 提供了一个 Embedding 基础类，各家模型开发商基于该基础类设计自己的嵌入类，以适应不同模型自身的嵌入转换方法。</p>
<blockquote>
<p>即使是同一家模型开发商，可能也存在参数规模大小不同的模型。每个模型有可能使用不同的嵌入转换方法，以便实现模型的最佳性能。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> OpenAIEmbeddings<br><br>embeddings = OpenAIEmbeddings(model=<span class="hljs-string">&quot;text-embedding-3-large&quot;</span>)<br>text = <span class="hljs-string">&quot;This is a test text.&quot;</span><br>query_embedding = embeddings.embed_query(text)<br></code></pre></td></tr></table></figure>
<h3 id="%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8" tabindex="-1" id="向量存储">向量存储</h3>
<p>向量一般基于相似度进行搜索，因此如何存储向量很重要，因为设计合理的索引能够极大的提高搜索效率。</p>
<h3 id="%E5%90%91%E9%87%8F%E7%B4%A2%E5%BC%95" tabindex="-1" id="向量索引">向量索引</h3>
<p>向量搜索的目标，是找出相似的内容。因此存储的核心原理是将类似的东西，凑在一起存储，这样一抓抓一窝。</p>
<blockquote>
<p>为提高写入速度以及充分利用存储空间，初步想法是在索引层面建立虚拟的空间结构，通过树或图来实现分门别类，底层存储则仍然跟传统存储方法类似。</p>
</blockquote>
<p>一些常见的搜索算法：</p>
<ul>
<li>
<p>点积量化：Product Quantization，将向量空间逐级划分为更小的子空间，这样搜索起来有点类似二分查找。子空间的划分有多种方法，例如：</p>
<ul>
<li>k-d tree 树：k 维树，每一维做一次二分查找，对于低维向量效果不错，但维数越高，效果越来越差；</li>
<li>嵌套超球
<ul>
<li>ball tree：球树，二叉或多叉，每个数据点仅会出现在一个叶节点上；</li>
<li>cover tree：覆盖树，多层嵌套，同一个数据点可能会出现在多个层中；</li>
</ul>
</li>
</ul>
</li>
<li>
<p>局部敏感哈希：LSH，locality sensitive hashing 将相似的数据点映射到相同的哈希桶中；为避免假阳性或者假阴性，会使用多个哈希函数。</p>
</li>
<li>
<p>分层导航小世界：HNSW，Hierarchical Navigable Small World</p>
<ul>
<li>每个数据节点先按指数概率随机分配层数，这样会导致越顶层的节点数越少，越底层的节点数越多。0 层拥有所有的数据节点；例如第 0 层的概率是 1，第 1 层的概率是 1/10，第 2 层的概率是 0.01，第3 层的概率是千分之一，以此类推。层数是按指数概率进行分配的，比如将概率基数定为 16，那么出现在第 10 层的概率是 (1/16)^10；假设总共有100亿个数据节点，那么出现在第 10 层的节点数 = 100亿 * (1/16)^10 &lt; 1;</li>
<li>每个数据节点在每层找最邻近的若干个（例如32个）节点做为邻居；这意味着这些邻居会成簇集中，越顶层簇数越少，越底层簇数越多。不同节点之间在下一层的簇是存在重叠的数据节点的，因为它们可能互为邻居。</li>
<li>0 层在使用贪心算法遍历邻居后，不再像其他层只返回某个最邻近节点，而是会返回一个 top-k 列表做为结果；</li>
<li>张三想在这个世界上找一批和自己长得比较像的人，整个搜索过程有点类似：
<ul>
<li>全世界每个国家派出一个代表，张三先在这批代表里面比对，哪个国家的人和自己长得最像；</li>
<li>假设上一步的结果是中国代表李四，接下来张三从李四所在的微信群里面继续找第二批候选人。这个微信群的群主是李四，是李四之前按照面相相似度组的群。</li>
<li>每个群的成员，都有外一个以自己做为群主的微信群，同时群主本人也是别人的微信群的成员。</li>
<li>就这样逐级向下寻找，直到最后一层（0层）的群，从中选出最像的 n 个人，然后停止查找，返回结果。</li>
</ul>
</li>
</ul>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251116195408.png" srcset="/img/loading.gif" lazyload alt=""></p>
<blockquote>
<p>HNSW 很好的平衡了性能和复杂度，因此使用广泛，是 Milvus、Pinecone、Qdrant 的默认索引之一（通常向量数据库会同时支持多种索引算法，这样用户可以根据使用场景，使用最合适的算法）；</p>
</blockquote>
</li>
</ul>
<h3 id="%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93" tabindex="-1" id="向量数据库">向量数据库</h3>
<p>向量数据库的一些使用场景：</p>
<ul>
<li>个性化推荐；</li>
<li>异常数据识别：例如检测危险的数据输入、欺诈等；</li>
<li>自然语言处理：例如语义分析、情感分析、文本分类等；</li>
</ul>
<p>向量数据库的一些特点：</p>
<ul>
<li>高效的相似性搜索；</li>
<li>支持高维数据；</li>
<li>支持一些高级的搜索功能（这些功能在常规数据库不容易实现，比如内容推荐）；</li>
</ul>
<p>一些主流的开源向量数据库：Milvus、Pinecone、Qdrant、Chroma、Weaviate 等；</p>
<p>LangChain 有一个 vecstores 模块用来实现向量存储，一般各向量数据库的接口放在该模块中；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.vectorstores <span class="hljs-keyword">import</span> Chroma<br><span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> CharacterTextSplitter<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> OpenAIEmbeddings<br><br>docs = <span class="hljs-string">&quot;I am a very long document.&quot;</span><br>text_splitter = CharacterTextSplitter(chunk_size=<span class="hljs-number">500</span>, chunk_overlap=<span class="hljs-number">0</span>, separator=<span class="hljs-string">&quot;/n&quot;</span>)<br>split_docs = text_splitter.split_text(docs)<br><br>embedding = OpenAIEmbeddings(model=<span class="hljs-string">&quot;text-embedding-3-large&quot;</span>)<br>vectorstore = Chroma.from_texts(split_docs, embedding)<br><br><span class="hljs-comment"># k 是待搜索返回的文本数量</span><br>similar_docs = vectorstore.similarity_search(<span class="hljs-string">&quot;I am a very long document.&quot;</span>, k=<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>
<h3 id="%E6%96%87%E6%A1%A3%E5%8A%A0%E8%BD%BD%E5%99%A8" tabindex="-1" id="文档加载器">文档加载器</h3>
<p>针对不同格式的内容，LangChain 内置了很多对应的加载器，例如：</p>
<ul>
<li>TextLoader</li>
<li>WebBaseLoader</li>
<li>ArxivLoader</li>
<li>YoutubeLoader</li>
<li>ImageCaptionLoader</li>
<li>WikipediaLoader</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># txt 文件示例</span><br><span class="hljs-keyword">from</span> langchain.document_loaders <span class="hljs-keyword">import</span> TextLoader<br><br>loder = TextLoader(<span class="hljs-string">&quot;./demo/data/demo.txt&quot;</span>)<br>docs = loder.load()<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Arvix 示例</span><br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser<br><span class="hljs-keyword">from</span> langchain_anthropic <span class="hljs-keyword">import</span> ChatAnthropic<br><span class="hljs-keyword">from</span> langchain_community.document_loaders <span class="hljs-keyword">import</span> ArxivLoader<br><br>docs = ArxivLoader(query=<span class="hljs-string">&quot;2201.11903&quot;</span>, max_results=<span class="hljs-number">3</span>).load()<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># LangChain hub 中内置了一些预设定的提示模板</span><br><span class="hljs-keyword">from</span> langchain <span class="hljs-keyword">import</span> hub<br><br><span class="hljs-comment"># 一个有关学术问答的提示模板</span><br>prompt = hub.pull(<span class="hljs-string">&quot;hwchase17/anthropic-paper-qa&quot;</span>)<br><span class="hljs-built_in">print</span>(prompt)<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">input_variables=[<span class="hljs-string">&#x27;text&#x27;</span>] input_types=&#123;&#125; partial_variables=&#123;&#125; metadata=&#123;<span class="hljs-string">&#x27;lc_hub_owner&#x27;</span>: <span class="hljs-string">&#x27;hwchase17&#x27;</span>, <span class="hljs-string">&#x27;lc_hub_repo&#x27;</span>: <span class="hljs-string">&#x27;anthropic-paper-qa&#x27;</span>, <span class="hljs-string">&#x27;lc_hub_commit_hash&#x27;</span>: <span class="hljs-string">&#x27;0b8e75415e4d1314431e2a22176dce33c65375d4b3be7a2e21c91819da6dfbf7&#x27;</span>&#125; messages=[HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=[<span class="hljs-string">&#x27;text&#x27;</span>], input_types=&#123;&#125;, partial_variables=&#123;&#125;, template=<span class="hljs-string">&#x27;Here is an academic paper: &lt;paper&gt;&#123;text&#125;&lt;/paper&gt;\n\nPlease do the following:\n1. Summarize the abstract at a kindergarten reading level. (In &lt;kindergarten_abstract&gt; tags.)\n2. Write the Methods section as a recipe from the Moosewood Cookbook. (In &lt;moosewood_methods&gt; tags.)\n3. Compose a short poem epistolizing the results in the style of Homer. (In &lt;homer_results&gt; tags.)\n4. Write a grouchy critique of the paper from a wizened PI. (In &lt;grouchy_critique&gt; tags.)&#x27;</span>), additional_kwargs=&#123;&#125;)]<br><br></code></pre></td></tr></table></figure>
<h3 id="langchain-%E7%9A%84%E6%A3%80%E7%B4%A2%E5%99%A8" tabindex="-1" id="LangChain-的检索器">LangChain 的检索器</h3>
<p>检索器（Retriever）的职责是完成查询，查询的目标可以是本地的数据库，但也可以是网页或者其他数据来源。针对不同的来源，LangChain 内置了一些常用的检索器，用于完成不同内容的检索查询，例如 kNN 和 PubMed。</p>
<h4 id="knn-%E6%A3%80%E7%B4%A2%E5%99%A8" tabindex="-1" id="kNN-检索器">kNN 检索器</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_community.retrievers <span class="hljs-keyword">import</span> KNNRetriever<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> OpenAIEmbeddings<br><br>words = [<span class="hljs-string">&quot;cat&quot;</span>, <span class="hljs-string">&quot;dog&quot;</span>, <span class="hljs-string">&quot;fish&quot;</span>, <span class="hljs-string">&quot;bird&quot;</span>, <span class="hljs-string">&quot;elephant&quot;</span>, <span class="hljs-string">&quot;giraffe&quot;</span>, <span class="hljs-string">&quot;lion&quot;</span>, <span class="hljs-string">&quot;tiger&quot;</span>]<br>retriever = KNNRetriever.from_texts(<br>    texts=words,<br>    embeddings=OpenAIEmbeddings(),<br>    k=<span class="hljs-number">3</span>,<br>)<br>result = retriever.get_relevant_documents(<span class="hljs-string">&quot;cat&quot;</span>)<br></code></pre></td></tr></table></figure>
<h4 id="pubmed-%E6%A3%80%E7%B4%A2%E5%99%A8" tabindex="-1" id="PubMed-检索器">PubMed 检索器</h4>
<p>PubMed 是一个用于医学文献领域的检索器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_community.retrievers.pubmed <span class="hljs-keyword">import</span> PubMedRetriever<br><br>retriever = PubMedRetriever()<br>documents = retriever.get_relevant_documents(<span class="hljs-string">&quot;cancer&quot;</span>)<br><span class="hljs-keyword">for</span> document <span class="hljs-keyword">in</span> documents:<br>    <span class="hljs-built_in">print</span>(document.metadata[<span class="hljs-string">&quot;title&quot;</span>])<br></code></pre></td></tr></table></figure>
<h4 id="%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A3%80%E7%B4%A2%E5%99%A8" tabindex="-1" id="自定义检索器">自定义检索器</h4>
<p>继承 BaseRetriever 类，实现一个 get_relevant_documents 的方法。根据查询参数，返回相关文档</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRetriever</span>(<span class="hljs-title class_ inherited__">BaseRetriever</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;My retriever.&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_relevant_documents</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        query: <span class="hljs-built_in">str</span>,</span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-type">List</span>[Document]:<br>        <span class="hljs-string">&quot;&quot;&quot;Get relevant documents.&quot;&quot;&quot;</span><br>        relevant_documents = []<br><br>        <span class="hljs-comment"># 根据query进行检索</span><br>        <br>        <span class="hljs-keyword">return</span> relevant_documents<br></code></pre></td></tr></table></figure>
<h3 id="%E5%85%B6%E4%BB%96" tabindex="-1" id="其他">其他</h3>
<h4 id="%E5%A4%9A%E8%B7%AF%E5%8F%AC%E5%9B%9E" tabindex="-1" id="多路召回">多路召回</h4>
<p>主要用于推荐系统的场景，综合多个不同的维度，给用户推荐某些内容和商品。例如最热门、同类产品、浏览记录、相似用户、打折促销、搜索时间段（白天或晚上）等。多路召回主要负责广度，之后将召回的结果交给其他算法排序（例如先去重，然后给不同的维度计算权重，最后得到一个排名）。</p>
<h4 id="bm25-%E7%AE%97%E6%B3%95" tabindex="-1" id="BM25-算法">BM25 算法</h4>
<p>best matching 25，BM25 用于判断某个查询 query （可能包含多个单词）与某个文档的相关性。根据相关性得分找出最匹配的 25 项。主要用于关键词的稀疏检索。另外还在基于语义的 Embeddding 稠密检索。二者可以结合使用，实现混合召回。</p>
<p>TF-IDF（词频-逆文档频率，Term Frequency-Inverse Document Frequency）的计算公式如下：</p>

    <span id="mjx-e7556f8">
      <style>
      #mjx-e7556f8{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="35.63ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 15748.3 1000" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(704,0)"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(1675.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2675.4,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(3179.4,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(4007.4,0)"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(4756.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(5145.4,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(5506.4,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(5951.1,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(6471.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(7137.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(8193.7,0)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(8897.7,0)"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(9646.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(10035.7,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(10396.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(10841.3,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(11361.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(11750.3,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="mi" transform="translate(12528.3,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(13032.3,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mi" transform="translate(13860.3,0)"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mo" transform="translate(14609.3,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(14998.3,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(15359.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mi>F</mi><mo>−</mo><mi>I</mi><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mi>F</mi><mo stretchy="false">(</mo><mi>t</mi><mo>,</mo><mi>d</mi><mo stretchy="false">)</mo><mi>×</mi><mi>I</mi><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container>
    </span>
  <p>其中：</p>
<ul>
<li>
    <span id="mjx-a7d10b3">
      <style>
      #mjx-a7d10b3{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="3.287ex" height="1.538ex" role="img" focusable="false" viewBox="0 -680 1453 680" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(704,0)"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>F</mi></math></mjx-assistive-mml></mjx-container>
    </span>
   表示某个单词 t 在文档中出现的次数；一般取归一化的值，以减少长文档的天然优势；</li>
<li>IDF 表示单词 t 在所有文档中的稀缺程度；</li>
</ul>
<p>标准 IDF 的计算公式为：</p>

    <span id="mjx-df3eec9">
      <style>
      #mjx-df3eec9{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -2.172ex;" xmlns="http://www.w3.org/2000/svg" width="22.994ex" height="5.451ex" role="img" focusable="false" viewBox="0 -1449.5 10163.2 2409.5" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="49" d="M328 0Q307 3 180 3T32 0H21V46H43Q92 46 106 49T126 60Q128 63 128 342Q128 620 126 623Q122 628 118 630T96 635T43 637H21V683H32Q53 680 180 680T328 683H339V637H317Q268 637 254 634T234 623Q232 620 232 342Q232 63 234 60Q238 55 242 53T264 48T317 46H339V0H328Z"></path><path data-c="44" d="M130 622Q123 629 119 631T103 634T60 637H27V683H228Q399 682 419 682T461 676Q504 667 546 641T626 573T685 470T708 336Q708 210 634 116T442 3Q429 1 228 0H27V46H60Q102 47 111 49T130 61V622ZM593 338Q593 439 571 501T493 602Q439 637 355 637H322H294Q238 637 234 628Q231 624 231 344Q231 62 232 59Q233 49 248 48T339 46H350Q456 46 515 95Q561 133 577 191T593 338Z" transform="translate(361,0)"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(1125,0)"></path></g><g data-mml-node="mo" transform="translate(1778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(2167,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2528,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(3194.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(4250.6,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(278,0)"></path><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(778,0)"></path></g><g data-mml-node="mo" transform="translate(5528.6,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mrow" transform="translate(5695.2,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M701 -940Q701 -943 695 -949H664Q662 -947 636 -922T591 -879T537 -818T475 -737T412 -636T350 -511T295 -362T250 -186T221 17T209 251Q209 962 573 1361Q596 1386 616 1405T649 1437T664 1450H695Q701 1444 701 1441Q701 1436 681 1415T629 1356T557 1261T476 1118T400 927T340 675T308 359Q306 321 306 250Q306 -139 400 -430T690 -924Q701 -936 701 -940Z"></path></g><g data-mml-node="mfrac" transform="translate(736,0)"><g data-mml-node="mi" transform="translate(1054,676)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mtext"><path data-c="44" d="M130 622Q123 629 119 631T103 634T60 637H27V683H228Q399 682 419 682T461 676Q504 667 546 641T626 573T685 470T708 336Q708 210 634 116T442 3Q429 1 228 0H27V46H60Q102 47 111 49T130 61V622ZM593 338Q593 439 571 501T493 602Q439 637 355 637H322H294Q238 637 234 628Q231 624 231 344Q231 62 232 59Q233 49 248 48T339 46H350Q456 46 515 95Q561 133 577 191T593 338Z"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(764,0)"></path></g><g data-mml-node="mo" transform="translate(1417,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1806,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2167,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><rect width="2756" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3732,0) translate(0 -0.5)"><path data-c="29" d="M34 1438Q34 1446 37 1448T50 1450H56H71Q73 1448 99 1423T144 1380T198 1319T260 1238T323 1137T385 1013T440 864T485 688T514 485T526 251Q526 134 519 53Q472 -519 162 -860Q139 -885 119 -904T86 -936T71 -949H56Q43 -949 39 -947T34 -937Q88 -883 140 -813Q428 -430 428 251Q428 453 402 628T338 922T245 1146T145 1309T46 1425Q44 1427 42 1429T39 1433T36 1436L34 1438Z"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>IDF</mtext><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>log</mi><mo data-mjx-texclass="NONE">⁡</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mfrac><mi>N</mi><mrow><mtext>DF</mtext><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></mfrac><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container>
    </span>
  <p>其中：</p>
<ul>
<li>N 表示总的文档数量；</li>
<li>DF 表示包含单词 t 的文档数量；</li>
</ul>
<p>相比 TF-IDF，BM25 做了两个改进：</p>
<ul>
<li>
<p>词频饱和：避免频率和相关性线性相关，而是边际递减；</p>
</li>
<li>
<p>文档长度归一化：避免长文档占据优势，因为文档越长也不一定代表相关性越高；</p>
</li>
<li>
<p>优点：简单，无须训练，计算高效；</p>
</li>
<li>
<p>缺点：基于关键词而不是语义进行匹配，效果依赖分词质量，结果不稳定；对拼写错误、模糊搜索不够友好；</p>
</li>
</ul>
<p>IDF 计算公式变为：</p>

    <span id="mjx-4784f4f">
      <style>
      #mjx-4784f4f{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -2.172ex;" xmlns="http://www.w3.org/2000/svg" width="35.474ex" height="5.475ex" role="img" focusable="false" viewBox="0 -1460 15679.6 2420" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="49" d="M328 0Q307 3 180 3T32 0H21V46H43Q92 46 106 49T126 60Q128 63 128 342Q128 620 126 623Q122 628 118 630T96 635T43 637H21V683H32Q53 680 180 680T328 683H339V637H317Q268 637 254 634T234 623Q232 620 232 342Q232 63 234 60Q238 55 242 53T264 48T317 46H339V0H328Z"></path><path data-c="44" d="M130 622Q123 629 119 631T103 634T60 637H27V683H228Q399 682 419 682T461 676Q504 667 546 641T626 573T685 470T708 336Q708 210 634 116T442 3Q429 1 228 0H27V46H60Q102 47 111 49T130 61V622ZM593 338Q593 439 571 501T493 602Q439 637 355 637H322H294Q238 637 234 628Q231 624 231 344Q231 62 232 59Q233 49 248 48T339 46H350Q456 46 515 95Q561 133 577 191T593 338Z" transform="translate(361,0)"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(1125,0)"></path></g><g data-mml-node="mo" transform="translate(1778,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(2167,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2528,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(3194.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(4250.6,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(278,0)"></path><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(778,0)"></path></g><g data-mml-node="mo" transform="translate(5528.6,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mrow" transform="translate(5695.2,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M701 -940Q701 -943 695 -949H664Q662 -947 636 -922T591 -879T537 -818T475 -737T412 -636T350 -511T295 -362T250 -186T221 17T209 251Q209 962 573 1361Q596 1386 616 1405T649 1437T664 1450H695Q701 1444 701 1441Q701 1436 681 1415T629 1356T557 1261T476 1118T400 927T340 675T308 359Q306 321 306 250Q306 -139 400 -430T690 -924Q701 -936 701 -940Z"></path></g><g data-mml-node="mfrac" transform="translate(736,0)"><g data-mml-node="mrow" transform="translate(220,710)"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mo" transform="translate(1110.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2110.4,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(2710.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(3099.4,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(3460.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(4071.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(5071.9,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500,0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(778,0)"></path></g></g><g data-mml-node="mrow" transform="translate(1275.2,-710)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(600,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(989,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1350,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(1961.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(2961.4,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500,0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(778,0)"></path></g></g><rect width="6549.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7748.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(8748.3,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(9248.3,0) translate(0 -0.5)"><path data-c="29" d="M34 1438Q34 1446 37 1448T50 1450H56H71Q73 1448 99 1423T144 1380T198 1319T260 1238T323 1137T385 1013T440 864T485 688T514 485T526 251Q526 134 519 53Q472 -519 162 -860Q139 -885 119 -904T86 -936T71 -949H56Q43 -949 39 -947T34 -937Q88 -883 140 -813Q428 -430 428 251Q428 453 402 628T338 922T245 1146T145 1309T46 1425Q44 1427 42 1429T39 1433T36 1436L34 1438Z"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>IDF</mtext><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mi>log</mi><mo data-mjx-texclass="NONE">⁡</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mfrac><mrow><mi>N</mi><mo>−</mo><mi>n</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>+</mo><mn>0.5</mn></mrow><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>+</mo><mn>0.5</mn></mrow></mfrac><mo>+</mo><mn>1</mn><mo data-mjx-texclass="CLOSE">)</mo></mrow></math></mjx-assistive-mml></mjx-container>
    </span>
  <p>其中：</p>
<ul>
<li>
    <span id="mjx-a1e5d95">
      <style>
      #mjx-a1e5d95{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="3.934ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 1739 1000" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(600,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(989,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(1350,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container>
    </span>
   表示包含单词 t 的文档数量；</li>
</ul>
<p>BM25 计算公式为：</p>

    <span id="mjx-eb708ee">
      <style>
      #mjx-eb708ee{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -3.98ex;" xmlns="http://www.w3.org/2000/svg" width="62.316ex" height="7.515ex" role="img" focusable="false" viewBox="0 -1562.5 27543.9 3321.5" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="53" d="M55 507Q55 590 112 647T243 704H257Q342 704 405 641L426 672Q431 679 436 687T446 700L449 704Q450 704 453 704T459 705H463Q466 705 472 699V462L466 456H448Q437 456 435 459T430 479Q413 605 329 646Q292 662 254 662Q201 662 168 626T135 542Q135 508 152 480T200 435Q210 431 286 412T370 389Q427 367 463 314T500 191Q500 110 448 45T301 -21Q245 -21 201 -4T140 27L122 41Q118 36 107 21T87 -7T78 -21Q76 -22 68 -22H64Q61 -22 55 -16V101Q55 220 56 222Q58 227 76 227H89Q95 221 95 214Q95 182 105 151T139 90T205 42T305 24Q352 24 386 62T420 155Q420 198 398 233T340 281Q284 295 266 300Q261 301 239 306T206 314T174 325T141 343T112 367T85 402Q55 451 55 507Z"></path><path data-c="63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z" transform="translate(556,0)"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(1000,0)"></path><path data-c="72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z" transform="translate(1500,0)"></path><path data-c="65" d="M28 218Q28 273 48 318T98 391T163 433T229 448Q282 448 320 430T378 380T406 316T415 245Q415 238 408 231H126V216Q126 68 226 36Q246 30 270 30Q312 30 342 62Q359 79 369 104L379 128Q382 131 395 131H398Q415 131 415 121Q415 117 412 108Q393 53 349 21T250 -11Q155 -11 92 58T28 218ZM333 275Q322 403 238 411H236Q228 411 220 410T195 402T166 381T143 340T127 274V267H333V275Z" transform="translate(1892,0)"></path></g><g data-mml-node="mo" transform="translate(2336,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(2725,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mo" transform="translate(3553,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(3997.7,0)"><path data-c="1D444" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path></g><g data-mml-node="mo" transform="translate(4788.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(5455.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="munderover" transform="translate(6511.2,0)"><g data-mml-node="mo"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="TeXAtom" transform="translate(148.2,-1087.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="TeXAtom" transform="translate(509.9,1150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtext" transform="translate(8121.9,0)"><path data-c="49" d="M328 0Q307 3 180 3T32 0H21V46H43Q92 46 106 49T126 60Q128 63 128 342Q128 620 126 623Q122 628 118 630T96 635T43 637H21V683H32Q53 680 180 680T328 683H339V637H317Q268 637 254 634T234 623Q232 620 232 342Q232 63 234 60Q238 55 242 53T264 48T317 46H339V0H328Z"></path><path data-c="44" d="M130 622Q123 629 119 631T103 634T60 637H27V683H228Q399 682 419 682T461 676Q504 667 546 641T626 573T685 470T708 336Q708 210 634 116T442 3Q429 1 228 0H27V46H60Q102 47 111 49T130 61V622ZM593 338Q593 439 571 501T493 602Q439 637 355 637H322H294Q238 637 234 628Q231 624 231 344Q231 62 232 59Q233 49 248 48T339 46H350Q456 46 515 95Q561 133 577 191T593 338Z" transform="translate(361,0)"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(1125,0)"></path></g><g data-mml-node="mo" transform="translate(9899.9,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(10288.9,0)"><g data-mml-node="mi"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(479,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(11061.8,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(11673.1,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mfrac" transform="translate(12173.3,0)"><g data-mml-node="mrow" transform="translate(3495.8,710)"><g data-mml-node="mtext"><path data-c="54" d="M36 443Q37 448 46 558T55 671V677H666V671Q667 666 676 556T685 443V437H645V443Q645 445 642 478T631 544T610 593Q593 614 555 625Q534 630 478 630H451H443Q417 630 414 618Q413 616 413 339V63Q420 53 439 50T528 46H558V0H545L361 3Q186 1 177 0H164V46H194Q264 46 283 49T309 63V339V550Q309 620 304 625T271 630H244H224Q154 630 119 601Q101 585 93 554T81 486T76 443V437H36V443Z"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(722,0)"></path></g><g data-mml-node="mo" transform="translate(1375,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(1764,0)"><g data-mml-node="mi"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(479,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2537,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2981.6,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mo" transform="translate(3809.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(4420.8,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mo" transform="translate(4921.1,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(5310.1,0)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mn" transform="translate(554,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mo" transform="translate(6489.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(7490.1,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(7990.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-1109.5)"><g data-mml-node="mtext"><path data-c="54" d="M36 443Q37 448 46 558T55 671V677H666V671Q667 666 676 556T685 443V437H645V443Q645 445 642 478T631 544T610 593Q593 614 555 625Q534 630 478 630H451H443Q417 630 414 618Q413 616 413 339V63Q420 53 439 50T528 46H558V0H545L361 3Q186 1 177 0H164V46H194Q264 46 283 49T309 63V339V550Q309 620 304 625T271 630H244H224Q154 630 119 601Q101 585 93 554T81 486T76 443V437H36V443Z"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(722,0)"></path></g><g data-mml-node="mo" transform="translate(1375,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(1764,0)"><g data-mml-node="mi"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(479,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2537,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2981.6,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mo" transform="translate(3809.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(4420.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(5421.1,0)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mn" transform="translate(554,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mo" transform="translate(6600.8,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mrow" transform="translate(7101.1,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M180 96T180 250T205 541T266 770T353 944T444 1069T527 1150H555Q561 1144 561 1141Q561 1137 545 1120T504 1072T447 995T386 878T330 721T288 513T272 251Q272 133 280 56Q293 -87 326 -209T399 -405T475 -531T536 -609T561 -640Q561 -643 555 -649H527Q483 -612 443 -568T353 -443T266 -270T205 -41Z"></path></g><g data-mml-node="mn" transform="translate(597,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1319.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2319.4,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(2970.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(3970.9,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(4622.1,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mfrac" transform="translate(5122.3,0)"><g data-mml-node="mrow" transform="translate(565.8,516.4) scale(0.707)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path></g><g data-mml-node="mi" transform="translate(278,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mo" transform="translate(1106,0) translate(0 -0.5)"><path data-c="7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path></g></g><g data-mml-node="mtext" transform="translate(220,-345) scale(0.707)"><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z"></path><path data-c="76" d="M338 431Q344 429 422 429Q479 429 503 431H508V385H497Q439 381 423 345Q421 341 356 172T288 -2Q283 -11 263 -11Q244 -11 239 -2Q99 359 98 364Q93 378 82 381T43 385H19V431H25L33 430Q41 430 53 430T79 430T104 429T122 428Q217 428 232 431H240V385H226Q187 384 184 370Q184 366 235 234L286 102L377 341V349Q377 363 367 372T349 383T335 385H331V431H338Z" transform="translate(500,0)"></path><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(1028,0)"></path><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" transform="translate(1528,0)"></path><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z" transform="translate(2084,0)"></path></g><rect width="1870.2" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7232.5,0) translate(0 -0.5)"><path data-c="29" d="M35 1138Q35 1150 51 1150H56H69Q113 1113 153 1069T243 944T330 771T391 541T416 250T391 -40T330 -270T243 -443T152 -568T69 -649H56Q43 -649 39 -647T35 -637Q65 -607 110 -548Q283 -316 316 56Q324 133 324 251Q324 368 316 445Q278 877 48 1123Q36 1137 35 1138Z"></path></g></g></g><rect width="15130.6" height="60" x="120" y="220"></rect></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>Score</mtext><mo stretchy="false">(</mo><mi>D</mi><mo>,</mo><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo data-mjx-texclass="OP">∑</mo><mrow data-mjx-texclass="ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow data-mjx-texclass="ORD"><mi>n</mi></mrow></munderover><mtext>IDF</mtext><mo stretchy="false">(</mo><msub><mi>q</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>⋅</mo><mfrac><mrow><mtext>TF</mtext><mo stretchy="false">(</mo><msub><mi>q</mi><mi>i</mi></msub><mo>,</mo><mi>D</mi><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><mtext>TF</mtext><mo stretchy="false">(</mo><msub><mi>q</mi><mi>i</mi></msub><mo>,</mo><mi>D</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo>⋅</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mn>1</mn><mo>−</mo><mi>b</mi><mo>+</mo><mi>b</mi><mo>⋅</mo><mfrac><mrow><mo data-mjx-texclass="ORD" stretchy="false">|</mo><mi>D</mi><mo data-mjx-texclass="ORD" stretchy="false">|</mo></mrow><mtext>avgdl</mtext></mfrac><mo data-mjx-texclass="CLOSE">)</mo></mrow></mrow></mfrac></math></mjx-assistive-mml></mjx-container>
    </span>
  <p>其中：</p>
<ul>
<li>
    <span id="mjx-640d64f">
      <style>
      #mjx-640d64f{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="9.499ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 4198.6 1000" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="54" d="M36 443Q37 448 46 558T55 671V677H666V671Q667 666 676 556T685 443V437H645V443Q645 445 642 478T631 544T610 593Q593 614 555 625Q534 630 478 630H451H443Q417 630 414 618Q413 616 413 339V63Q420 53 439 50T528 46H558V0H545L361 3Q186 1 177 0H164V46H194Q264 46 283 49T309 63V339V550Q309 620 304 625T271 630H244H224Q154 630 119 601Q101 585 93 554T81 486T76 443V437H36V443Z"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(722,0)"></path></g><g data-mml-node="mo" transform="translate(1375,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(1764,0)"><g data-mml-node="mi"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(479,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2537,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2981.6,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g><g data-mml-node="mo" transform="translate(3809.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>TF</mtext><mo stretchy="false">(</mo><msub><mi>q</mi><mi>i</mi></msub><mo>,</mo><mi>D</mi><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container>
    </span>
   是单词 
    <span id="mjx-8260a3e">
      <style>
      #mjx-8260a3e{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="1.041ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 460 636" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></mjx-assistive-mml></mjx-container>
    </span>
   在文档 $ D $ 中出现的次数</li>
<li>( k_1 )：控制词频饱和程度的参数，通常取值范围为 <strong>1.2 ~ 2.0</strong></li>
<li>( b )：控制文档长度归一化强度的参数，通常设为 <strong>0.75</strong></li>
<li>( |D| )：文档 ( D ) 的长度（通常以词数计）</li>
</ul>
<h4 id="%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95" tabindex="-1" id="倒排索引">倒排索引</h4>
<ul>
<li>正排索引：基于 ID 找文档；</li>
<li>倒排索引：基于文档中的关键字，找文档 ID；</li>
</ul>
<p>BM25 需要通过倒排索引，找到关键词对应的文档 ID，然后找出文档，以便能够计算相关性得分。</p>
<h4 id="%E8%AF%8D%E8%A2%8B%E6%A8%A1%E5%9E%8B" tabindex="-1" id="词袋模型">词袋模型</h4>
<p>将句子或文档，看成是单词的组合（不考虑顺序）。所有单词即构成词汇表，之后可用于将句子或文档向量化，方便进行相关性检索。</p>
<h4 id="%E6%B7%B7%E5%90%88%E6%A3%80%E7%B4%A2" tabindex="-1" id="混合检索">混合检索</h4>
<p>同时使用稀疏和稠密两种方法进行检索，之后有两种方法整合检索结果：</p>
<ul>
<li>方法一：直接融合，去重后按一定规则（加权、RRF）进行打分排序；</li>
<li>方法二：线性组合，score = α * BM25 + (1−α) * CosineSimRRF</li>
</ul>
<h4 id="%E5%80%92%E5%BA%8F%E8%9E%8D%E5%90%88-rrf" tabindex="-1" id="倒序融合-RRF">倒序融合 RRF</h4>
<p>RRF：Reciprocal Rank Fusion，倒序融合。加总各个结果在各自的子列表中的排名得分后，进行总的排序；背后的核心思路是一个结果在子列表中的排名越靠前，那么相关性越高。如果一个检索结果在所有子列表中都排名靠前，那么应该给它高分，排名靠后则给低分。</p>

    <span id="mjx-bee67ef">
      <style>
      #mjx-bee67ef{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" display="true" style="position: relative;"><svg style="vertical-align: -2.819ex;" xmlns="http://www.w3.org/2000/svg" width="27.492ex" height="6.354ex" role="img" focusable="false" viewBox="0 -1562.5 12151.6 2808.5" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mtext"><path data-c="52" d="M130 622Q123 629 119 631T103 634T60 637H27V683H202H236H300Q376 683 417 677T500 648Q595 600 609 517Q610 512 610 501Q610 468 594 439T556 392T511 361T472 343L456 338Q459 335 467 332Q497 316 516 298T545 254T559 211T568 155T578 94Q588 46 602 31T640 16H645Q660 16 674 32T692 87Q692 98 696 101T712 105T728 103T732 90Q732 59 716 27T672 -16Q656 -22 630 -22Q481 -16 458 90Q456 101 456 163T449 246Q430 304 373 320L363 322L297 323H231V192L232 61Q238 51 249 49T301 46H334V0H323Q302 3 181 3Q59 3 38 0H27V46H60Q102 47 111 49T130 61V622ZM491 499V509Q491 527 490 539T481 570T462 601T424 623T362 636Q360 636 340 636T304 637H283Q238 637 234 628Q231 624 231 492V360H289Q390 360 434 378T489 456Q491 467 491 499Z"></path><path data-c="52" d="M130 622Q123 629 119 631T103 634T60 637H27V683H202H236H300Q376 683 417 677T500 648Q595 600 609 517Q610 512 610 501Q610 468 594 439T556 392T511 361T472 343L456 338Q459 335 467 332Q497 316 516 298T545 254T559 211T568 155T578 94Q588 46 602 31T640 16H645Q660 16 674 32T692 87Q692 98 696 101T712 105T728 103T732 90Q732 59 716 27T672 -16Q656 -22 630 -22Q481 -16 458 90Q456 101 456 163T449 246Q430 304 373 320L363 322L297 323H231V192L232 61Q238 51 249 49T301 46H334V0H323Q302 3 181 3Q59 3 38 0H27V46H60Q102 47 111 49T130 61V622ZM491 499V509Q491 527 490 539T481 570T462 601T424 623T362 636Q360 636 340 636T304 637H283Q238 637 234 628Q231 624 231 492V360H289Q390 360 434 378T489 456Q491 467 491 499Z" transform="translate(736,0)"></path><path data-c="46" d="M128 619Q121 626 117 628T101 631T58 634H25V680H582V676Q584 670 596 560T610 444V440H570V444Q563 493 561 501Q555 538 543 563T516 601T477 622T431 631T374 633H334H286Q252 633 244 631T233 621Q232 619 232 490V363H284Q287 363 303 363T327 364T349 367T372 373T389 385Q407 403 410 459V480H450V200H410V221Q407 276 389 296Q381 303 371 307T348 313T327 316T303 317T284 317H232V189L233 61Q240 54 245 52T270 48T333 46H360V0H348Q324 3 182 3Q51 3 36 0H25V46H58Q100 47 109 49T128 61V619Z" transform="translate(1472,0)"></path></g><g data-mml-node="mo" transform="translate(2125,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(2514,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(3034,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(3700.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="munderover" transform="translate(4756.6,0)"><g data-mml-node="mo"><path data-c="2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path></g><g data-mml-node="TeXAtom" transform="translate(148.2,-1087.9) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="TeXAtom" transform="translate(509.9,1150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mfrac" transform="translate(6367.2,0)"><g data-mml-node="mn" transform="translate(2642.2,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(743.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="msub" transform="translate(1743.4,0)"><g data-mml-node="mtext"><path data-c="72" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T98 122T98 161T98 203Q98 234 98 269T98 328L97 351Q94 370 83 376T38 385H20V408Q20 431 22 431L32 432Q42 433 60 434T96 436Q112 437 131 438T160 441T171 442H174V373Q213 441 271 441H277Q322 441 343 419T364 373Q364 352 351 337T313 322Q288 322 276 338T263 372Q263 381 265 388T270 400T273 405Q271 407 250 401Q234 393 226 386Q179 341 179 207V154Q179 141 179 127T179 101T180 81T180 66V61Q181 59 183 57T188 54T193 51T200 49T207 48T216 47T225 47T235 46T245 46H276V0H267Q249 3 140 3Q37 3 28 0H20V46H36Z"></path><path data-c="61" d="M137 305T115 305T78 320T63 359Q63 394 97 421T218 448Q291 448 336 416T396 340Q401 326 401 309T402 194V124Q402 76 407 58T428 40Q443 40 448 56T453 109V145H493V106Q492 66 490 59Q481 29 455 12T400 -6T353 12T329 54V58L327 55Q325 52 322 49T314 40T302 29T287 17T269 6T247 -2T221 -8T190 -11Q130 -11 82 20T34 107Q34 128 41 147T68 188T116 225T194 253T304 268H318V290Q318 324 312 340Q290 411 215 411Q197 411 181 410T156 406T148 403Q170 388 170 359Q170 334 154 320ZM126 106Q126 75 150 51T209 26Q247 26 276 49T315 109Q317 116 318 175Q318 233 317 233Q309 233 296 232T251 223T193 203T147 166T126 106Z" transform="translate(392,0)"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(892,0)"></path><path data-c="6B" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T97 124T98 167T98 217T98 272T98 329Q98 366 98 407T98 482T98 542T97 586T97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V463L180 233L240 287Q300 341 304 347Q310 356 310 364Q310 383 289 385H284V431H293Q308 428 412 428Q475 428 484 431H489V385H476Q407 380 360 341Q286 278 286 274Q286 273 349 181T420 79Q434 60 451 53T500 46H511V0H505Q496 3 418 3Q322 3 307 0H299V46H306Q330 48 330 65Q330 72 326 79Q323 84 276 153T228 222L176 176V120V84Q176 65 178 59T189 49Q210 46 238 46H254V0H246Q231 3 137 3T28 0H20V46H36Z" transform="translate(1448,0)"></path></g><g data-mml-node="mi" transform="translate(2009,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(4046.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(4435.4,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(4955.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><rect width="5544.4" height="60" x="120" y="220"></rect></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>RRF</mtext><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo data-mjx-texclass="OP">∑</mo><mrow data-mjx-texclass="ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow data-mjx-texclass="ORD"><mi>n</mi></mrow></munderover><mfrac><mn>1</mn><mrow><mi>k</mi><mo>+</mo><msub><mtext>rank</mtext><mi>i</mi></msub><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">)</mo></mrow></mfrac></math></mjx-assistive-mml></mjx-container>
    </span>
  <blockquote>
<p>k 是平滑系数，通常设置为 60（经验值）；</p>
</blockquote>
<p>优点：计算简单高效、无须训练、鲁棒性好；常用于粗排场景，之后还可以再次进行细排；</p>
<h4 id="%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A0%81-cross-encoder" tabindex="-1" id="交叉编码-Cross-Encoder">交叉编码 Cross-Encoder</h4>
<p>粗排结果通常使用 Bi-Encoder 双塔模型获得，此时 query 和 document 是各自编码，使用点积或余弦计算相似性，缺少二者每个单词之间的交叉注意力，因此只有一个大概的相关性。Cross-Encoder 的理念是将 query 和 document 组合起来，输入 Transformer 编码器，通过算 query 和 document 之间的自注意力，获得一个更准确的相关性分数，从而实现精排。</p>
<ul>
<li>优点：准确度高</li>
<li>缺点：计算慢，因为不能预计算，所以不适合处理大规模的重排。</li>
</ul>
<pre><code class=" mermaid">graph LR
A[用户问题] --&gt; B&#123;召回阶段&#125;
B --&gt;|BM25| C[候选文档 Top-100]
B --&gt;|Dense Retrieval| D[候选文档 Top-100]
C &amp; D --&gt; E[去重合并]
E --&gt; F[Cross-Encoder 精排]
F --&gt; G[Top-5 最相关文档]
G --&gt; H[LLM 生成答案]

</code></pre>
<blockquote>
<p>有时候 Cross-Encoder 在一些垂直领域的表现不如预期，此时可能需要考虑对模型进行微调，以便模型可以学会垂直领域的知识，提高相关性判断的准确性。</p>
</blockquote>
<h4 id="%E8%B4%9F%E9%87%87%E6%A0%B7" tabindex="-1" id="负采样">负采样</h4>
<p>负采样是一种训练嵌入模型的技术，正常情况下我们给模型提供正确答案，让它学习正确的参数。如果我们同时提供一些似是而非的错误答案，那么有助于模型参数更快更准确的收敛。</p>
<p>有几种负采样的方法：</p>
<ul>
<li>随机负采样：效果一般；</li>
<li>内负采样：同批次的其他答案作为错误答案；优点是简单，缺点是可能误判，因为其他答案有可能是相关的。</li>
<li>高难度负采样：使用检索结果 top-k 之外的高排名答案作为负采样；</li>
</ul>
<h4 id="%E6%9C%80%E5%A4%A7%E8%BE%B9%E9%99%85%E6%8E%92%E5%BA%8F%E6%8D%9F%E5%A4%B1" tabindex="-1" id="最大边际排序损失">最大边际排序损失</h4>
<p>Margin Ranking Loss，一种损失函数，可用来训练嵌入模型的。需要提供正负样本对。然后模型需要不断调整参数，直到正样本和负样本的得分差，大于指定的阈值（边际值），以便能够拉开二者的差距。</p>
<h4 id="%E5%B5%8C%E5%85%A5%E5%BE%AE%E8%B0%83" tabindex="-1" id="嵌入微调">嵌入微调</h4>
<p>常规的嵌入模型是面向通用场景，对于垂直领域的知识来说，有可能检索效果不佳。此时需要微调嵌入模型，以便让其能够返回更准确的匹配结果。</p>
<blockquote>
<p>LLM 只读取检索返回的文本内容，不直接读取 Embedding 模型的向量。因此对 Embedding 模型进行微调，并不会影响 LLM 的回答质量。但是微调 Embedding 也是有风险的，因为一些用词在微调后，可能具备了专业含义。此时如果用户提问的正好是非专业的问题，则有可能造成检索结果的不匹配。微调的数据质量也很重要，如果质量不高，则也有可能造成语义扭曲。</p>
</blockquote>
<h4 id="%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98" tabindex="-1" id="参数调优">参数调优</h4>
<p>一些常见的调优方法：</p>
<ul>
<li>文本拆分参数：chunk_size、overlap</li>
<li>查询重写；</li>
<li>提示词模板；</li>
</ul>
<h4 id="%E6%A3%80%E7%B4%A2%E6%8C%87%E6%A0%87" tabindex="-1" id="检索指标">检索指标</h4>
<p>Recall@k：假设正确的结果有 100 个，检索返回的结果中，包含多少个正确结果；这个指标越高，表示找的越全。</p>
<p>Precision@k：假设使用 top-5，返回的 5 个结果中，有 3 个是正确的，那么指标值为 0.6，用来表示找得准不准；</p>
<blockquote>
<p>k 的常见取值为 1,3, 5, 10，并不是越大越好，因为 LLM 的上下文窗口可能不允许；</p>
</blockquote>
<p>MRR：mean reciprocal rank，平均倒数排名；检索返回的结果中，第一个跟查询相关的结果，其排名位置的倒数。可用来评估排序质量（貌似也可顺便评估检索质量，如果总是 0，则说明没有命中）；这个指标通常用来评估只需要回答单个答案的场景。</p>
<h4 id="%E6%9C%80%E5%A4%A7%E8%BE%B9%E9%99%85%E7%9B%B8%E5%85%B3%E6%80%A7" tabindex="-1" id="最大边际相关性">最大边际相关性</h4>
<p>MMR：Max Margin Relevance，最大边际相关性；一种向量检索策略，考虑相关性的同时，还考虑结果的多样性。避免因为单一的相关性导致结果出现很多冗余重复。简单来说是“尽可能挑选相关性的，但别跟已挑好的太过相似”；</p>
<h2 id="%E4%BD%BF%E7%94%A8%E6%A3%80%E7%B4%A2%E5%99%A8%E5%AE%9E%E7%8E%B0%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA" tabindex="-1" id="使用检索器实现聊天机器人">使用检索器实现聊天机器人</h2>
<p>使用检索器实现聊天机器人涉及三个部分：</p>
<ul>
<li>使用文档加载器读取领域知识；</li>
<li>将知识转换成向量存储到数据库中；</li>
<li>聊天回复时，使用检索器从数据库中读取知识，作为上下文和问题一起输入大模型生成答案；</li>
</ul>
<p>为提高上下文的 token 使用效率，检索器支持对上下文进行压缩，常见的压缩方法包括：</p>
<ul>
<li>LLMChainExtractor：使用模型从检索到的文档中提取内容</li>
<li>LLMChainFilter：使用模型过滤掉无关文档</li>
<li>EmbeddingsFilter：基于相似性得分进行过滤；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_community.vectorstores.docarray <span class="hljs-keyword">import</span> DocArrayInMemorySearch<br><span class="hljs-keyword">from</span> langchain_community.embeddings.huggingface <span class="hljs-keyword">import</span> HuggingFaceEmbeddings<br><span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter<br><span class="hljs-keyword">from</span> langchain_core.retrievers <span class="hljs-keyword">import</span> BaseRetriever<br><span class="hljs-keyword">from</span> langchain.schema <span class="hljs-keyword">import</span> Document<br><span class="hljs-keyword">from</span> langchain.retrievers.document_compressors.embeddings_filter <span class="hljs-keyword">import</span> EmbeddingsFilter<br><span class="hljs-keyword">from</span> langchain.retrievers <span class="hljs-keyword">import</span> ContextualCompressionRetriever<br><br><span class="hljs-comment"># 创建检索器(实时，非离线），带过滤功能（使用场景：根据用户上传的文档进行检索）</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">configure_retriever</span>(<span class="hljs-params"></span><br><span class="hljs-params">    docs: <span class="hljs-built_in">list</span>[Document], use_compress: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span><br><span class="hljs-params"></span>) -&gt; BaseRetriever:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    配置并返回一个文档检索器</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        docs: 文档列表，用于创建检索器</span><br><span class="hljs-string">        use_compress: 是否使用嵌入过滤器进行上下文压缩，默认为True</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        BaseRetriever: 配置好的文档检索器实例</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 将文档分割成较小的片段以便更好地检索</span><br>    text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="hljs-number">1500</span>, chunk_overlap=<span class="hljs-number">200</span>)<br>    splits = text_splitter.split_documents(docs)<br>    embeddings = HuggingFaceEmbeddings(<br>        model_name=<span class="hljs-string">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span><br>    )<br>    <span class="hljs-comment"># 此处使用 DocArrayInMemorySearch 模拟向量数据库，提供存储和检索功能</span><br>    vectordb = DocArrayInMemorySearch.from_documents(splits, embeddings)<br>    <span class="hljs-comment"># 创建一个向量数据库检索器，search_type 使用最大边际相关性（MMR）进行搜索，它优先处理相似的同时，还会兼具结果多样性。其它 search_type 有：similarity、similarity_score_threshold</span><br>    retriever = vectordb.as_retriever(<br>        search_type=<span class="hljs-string">&quot;mmr&quot;</span>, search_kwargs=&#123;<span class="hljs-string">&quot;k&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&quot;fetch_k&quot;</span>: <span class="hljs-number">4</span>&#125;<br>    )<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> use_compress:<br>        <span class="hljs-keyword">return</span> retriever<br><br>    <span class="hljs-comment"># 创建嵌入过滤器以提高检索结果的相关性</span><br>    embeddings_filter = EmbeddingsFilter(<br>        embeddings=embeddings, similarity_threshold=<span class="hljs-number">0.8</span><br>    )<br>    <span class="hljs-comment"># 创建一个上下文压缩检索器，使用嵌入过滤器进行上下文压缩</span><br>    <span class="hljs-keyword">return</span> ContextualCompressionRetriever(<br>        base_compressor=embeddings_filter,<br>        base_retriever=retriever,<br>    )<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 创建一个链，以便融合各个功能对象，和用户聊天并回答问题</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">configure_chain</span>(<span class="hljs-params">retriever: BaseRetriever</span>) -&gt; Chain:<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    配置并返回一个链，用于处理用户输入并生成响应</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        retriever: 文档检索器实例</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        Chain: 配置好的链实例</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    llm = ChatOpenAI(model_name=<span class="hljs-string">&quot;gpt-3.5-turbo&quot;</span>, temperature=<span class="hljs-number">0</span>, streaming=<span class="hljs-literal">True</span>)<br>    memory = ConversationBufferMemory(memory_key=<span class="hljs-string">&quot;chat_history&quot;</span>, return_messages=<span class="hljs-literal">True</span>)<br>    max_tokens_limit = <span class="hljs-number">4000</span><br>    <span class="hljs-keyword">return</span> ConversationalRetrievalChain.from_llm(<br>        llm,<br>        retriever=retriever,<br>        memory=memory,<br>        verbose=<span class="hljs-literal">True</span>,<br>        max_tokens_limit=max_tokens_limit,<br>    )<br></code></pre></td></tr></table></figure>
<h3 id="%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BF%86" tabindex="-1" id="对话记忆">对话记忆</h3>
<p>对于聊天机器人来说，保持一定的历史对话记录是很重要的。LangChain 有多种管理记忆的方法，分别如下：</p>
<ul>
<li>临时会话记忆
<ul>
<li>ConversationBufferMemory：简单缓存，保留所有历史对话；</li>
<li>ConversationBufferWindowMemory：保留最近的 N 轮对话；</li>
<li>ConversationTokenBufferMemory：保留多少个 Token 以内的对话（用来控制上下文长度）；</li>
<li>ConversationSummaryMemory：从历史对话中提取摘要，节省上下文的长度；</li>
<li>ConversationSummaryBufferMemory：摘要 + 最近 N 轮对话</li>
</ul>
</li>
<li>持久会话记忆：需要外部数据库进行存储
<ul>
<li>RedisChatMessageHistory</li>
<li>PostgresChatMessageHistory</li>
</ul>
</li>
</ul>
<p>以上多种对话缓存机制可以同时使用，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">llm = OpenAI(temperature=<span class="hljs-number">0.9</span>)<br><span class="hljs-comment"># 保留所有聊天记录</span><br>conv_memory = ConversationBufferMemory(<br>    memory_key=<span class="hljs-string">&quot;chat_history_lines&quot;</span>, input_key=<span class="hljs-string">&quot;input&quot;</span><br>)<br><span class="hljs-comment"># 仅保留聊天记录摘要，可节省 token</span><br>summary_memory = ConversationSummaryMemory(<br>    llm=llm, memory_key=<span class="hljs-string">&quot;chat_history_summary&quot;</span>, input_key=<span class="hljs-string">&quot;input&quot;</span><br>)<br><span class="hljs-comment"># 合并两种聊天记录记忆类型</span><br>memory = CombinedMemory(memories=[conv_memory, summary_memory])<br></code></pre></td></tr></table></figure>
<p>Memory 默认将对话历史存放在内存中，但也支持存储在外部数据库，例如 Redis；示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 已抽象专门的 Redis 对话历史类</span><br><span class="hljs-keyword">from</span> langchain_community.chat_message_histories <span class="hljs-keyword">import</span> RedisChatMessageHistory<br><br>history = RedisChatMessageHistory(session_id=<span class="hljs-string">&quot;user_123&quot;</span>, url=<span class="hljs-string">&quot;redis://localhost:6379&quot;</span>)<br>memory = ConversationBufferMemory(chat_memory=history, return_messages=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>
<p>在创建 Agent 或 Chain 时，只需要将初始好的 Memory 做为参数传入即可。之后 Chain/Agent 在向 LLM 发送请求前，会自动从 Memory 中读取历史会话信息，然后放到 Prompt 模板的占位符中。在得到 LLM 的响应后，又会将该响应存入 Memory。</p>
<h2 id="%E8%B0%83%E8%8A%82%E5%93%8D%E5%BA%94" tabindex="-1" id="调节响应">调节响应</h2>
<p>大模型的答案需要合乎法律和道德规范，因此有必要设立一个检查机制，包括：</p>
<ul>
<li>过滤仇恨言论、攻击性内容等</li>
<li>符合公司的品牌形象；</li>
<li>防止用户的非法输入和滥用；</li>
<li>遵守法律；</li>
</ul>
<p>LangChain 有内置了一个 OpenAIModerationChain 用于实现此目标，它会对待输出内容进行检查，确保内容安全。如果内容违反规则，则会触反一些警报机制或错误信息。</p>
<h2 id="%E9%98%B2%E6%8A%A4" tabindex="-1" id="防护">防护</h2>
<p>用来控制大模型的回答方向，包括：</p>
<ul>
<li>避免讨论敏感的政治议题；</li>
<li>预定义会话路径：确保模型的聊天按照设定的流程进行，而不是随意发挥；</li>
<li>设定语言风格；</li>
<li>提取结构化数据；</li>
</ul>
<h1 id="%E5%88%A9%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BC%80%E5%8F%91%E8%BD%AF%E4%BB%B6" tabindex="-1">利用大模型开发软件</h1>
<h2 id="%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD" tabindex="-1" id="软件开发与人工智能">软件开发与人工智能</h2>
<p>使用大模型来辅助软件开发已经取得了非常大的进步，尤其是在生成单一功能的代码片段方面。目前这个领域发展很迅速，各种技术在不断的迭代。最终能够达到什么样的高度，还有待观察。</p>
<p>一些常见的使用场景：</p>
<ul>
<li>代码自动补全；</li>
<li>自动生成测试代码；</li>
<li>代码解释；</li>
<li>代码搜索；</li>
<li>漏洞排查；</li>
<li>自动生成功能代码（过于复杂的功能暂时不行）；</li>
</ul>
<h2 id="%E4%BD%BF%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81" tabindex="-1" id="使用大模型编写代码">使用大模型编写代码</h2>
<p>一些辅助开发的 IDE 插件：</p>
<table>
<thead>
<tr>
<th>插件名称</th>
<th>特点</th>
<th>适用场景</th>
<th>是否免费</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GitHub Copilot</strong></td>
<td>OpenAI 驱动，根据注释/上下文生成高质量代码</td>
<td>快速原型、算法实现、多语言支持</td>
<td>❌（$10/月，学生免费）</td>
</tr>
<tr>
<td><strong>Amazon CodeWhisperer</strong></td>
<td>AWS 官方出品，集成云服务代码+安全扫描</td>
<td>AWS 云开发、安全审计</td>
<td>✅（个人免费）</td>
</tr>
<tr>
<td><strong>Tabnine</strong></td>
<td>支持本地模型，隐私强，响应快</td>
<td>敏感项目、离线环境</td>
<td>✅（基础功能免费）</td>
</tr>
<tr>
<td><strong>通义灵码（TONGYI Lingma）</strong></td>
<td>阿里云出品，中文友好，支持代码优化</td>
<td>国内团队、阿里云生态</td>
<td>✅（个人免费）</td>
</tr>
<tr>
<td><strong>CodeGeeX</strong></td>
<td>清华开源，完全免费，支持代码翻译/解释</td>
<td>学生、跨语言迁移</td>
<td>✅</td>
</tr>
<tr>
<td><strong>Bito</strong></td>
<td>基于 GPT-4，支持代码解释、测试生成、技术问答</td>
<td>新手学习、遗留代码维护</td>
<td>✅（注册即用，API 自费）</td>
</tr>
<tr>
<td><strong>Codeium</strong></td>
<td>免费开源，支持代码搜索与复用</td>
<td>开源贡献、代码复用</td>
<td>✅</td>
</tr>
</tbody>
</table>
<p>一些集成 AI 的 IDE：</p>
<ul>
<li>Cursor</li>
<li>Trae</li>
<li>Qoder</li>
<li>Kiro</li>
</ul>
<h2 id="%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91" tabindex="-1" id="自动化软件开发">自动化软件开发</h2>
<p>使用大模型进行软件的自动开发有两种实现方式：</p>
<ul>
<li>规划任务，将开发任务拆解成多个小任务。每个任务按照“计划 -&gt; 行动 -&gt; 审查”的模式进行。如果审查通过，则进入下一个子任务；如果审查不通过，则调整方案，重新循环；</li>
</ul>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/20251117180338.png" srcset="/img/loading.gif" lazyload alt=""></p>
<ul>
<li>多个不同角色的智能体相互协作，类似 MetaGPT；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> metagpt.software_company <span class="hljs-keyword">import</span> SoftwareCompany<br><span class="hljs-keyword">from</span> metagpt.roles <span class="hljs-keyword">import</span> ProjectManager, ProductManager, Architect, Engineer<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup</span>(<span class="hljs-params">idea: <span class="hljs-built_in">str</span>, investment: <span class="hljs-built_in">float</span> = <span class="hljs-number">3.0</span>, n_round: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Run a startup. Be a boss&quot;&quot;&quot;</span><br>    company = SoftwareCompany()<br>    company.hire(ProjectManager(), ProductManager(), Architect(), Engineer())<br>    company.invest(investment)<br>    company.start(idea)<br>    <span class="hljs-keyword">await</span> company.run(n_round)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>在 LangChain 中直接集成自动代码开发功能是比较危险的，因为生成的代码拥有很大的权限，可以随意访问电脑上的任意文件。因此更好的做法是让其在沙箱中执行，与本地环境进行隔离。</p>
</blockquote>
<h1 id="%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B" tabindex="-1">用于数据科学的大模型</h1>
<h1 id="%E5%AE%9A%E5%88%B6%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%85%B6%E8%BE%93%E5%87%BA" tabindex="-1">定制大模型及其输出</h1>
<h2 id="%E8%B0%83%E8%8A%82%E5%A4%A7%E6%A8%A1%E5%9E%8B" tabindex="-1" id="调节大模型">调节大模型</h2>
<p>控制大模型输出的方法：</p>
<ul>
<li>训练阶段
<ul>
<li>整理数据</li>
<li>选择损失函数</li>
<li>设计架构</li>
</ul>
</li>
<li>微调：使用特定数据集进行二次训练，提高模型在特定任务上的性能表现；</li>
<li>提示工程</li>
<li>人工监督：人机反馈回环，强化学习 RLHF</li>
</ul>
<h3 id="%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0" tabindex="-1" id="强化学习">强化学习</h3>
<p>RLHF（基于人类反馈的强化学习）的三个步骤：</p>
<ul>
<li>监督预训练</li>
<li>奖励训练：设计一套打分标准，对模型的输出进行打分；</li>
<li>RL 微调：设计 RL 算法，引导模型实现奖励最大化；</li>
</ul>
<h3 id="%E4%BD%8E%E8%BD%B6%E9%80%82%E5%BA%94" tabindex="-1" id="低轶适应">低轶适应</h3>
<p>参数高效微调（PEFT，Parameter Efficient Fine Tuning）是一种微调方法，其原理是只微调少量参数（例如少于1%）来提高模型性能，这样训练量更小。其背心的原理在于，针对特定任务，需要变更的模型参数是稀疏的。因此，我们可以基于这个事实，找出这些少量待变更的参数即可。</p>
<p>低秩适应（LoRA，Low-Rank Adaptation）是 PEFT 的一种实现方式。它冻结原始参数，并给每一层 Transformer 引入一个可训练的秩分解矩阵；</p>
<blockquote>
<p>秩分解：将一个大矩阵 
    <span id="mjx-6612536">
      <style>
      #mjx-6612536{
        display:contents;
        mjx-assistive-mml {
          user-select: text !important;
          clip: auto !important;
          color: rgba(0,0,0,0);
        }
        
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

      }
      </style>
      <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="2.371ex" height="1.595ex" role="img" focusable="false" viewBox="0 -683 1048 705" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>W</mi></math></mjx-assistive-mml></mjx-container>
    </span>
   近似表示为两个低秩矩阵的乘积。假设大矩阵的尺寸是 m x n，那么可以拆分成 m x r 和 r x n 两个小矩阵的乘积。原本需要训练的参数量是 m x n，拆分后，需要训练的参数量为 m x r + r x n；如果 r 设置得非常小，那么需要训练的参数将大大减少，例如可以减少 100 倍；</p>
<p>示例：768 x 768 的大矩阵，需要训练的参数量是 768×768=590K；拆分成 768 x 8 和 8 x 768 的两个矩阵后，需要训练的参数量变成了 768 * 8 + 8 * 768 = 12K，相比原始参数，数量少了约 50 倍；</p>
</blockquote>
<p>QLoRA 是在 LoRA 的基础上使用了量化方法，使用更少的位数来表示参数（例如 32 位的浮点数改用 4 或 8 位整数来表示），进一步节省了内存要求；</p>
<h3 id="%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B" tabindex="-1" id="提示工程">提示工程</h3>
<p>一些常用的技术：</p>
<ul>
<li>提示设计：基于预期的行为，提供自然语言进行指导，让模型输出预期结果；</li>
<li>限制词元：强制排除或者包含某些特定的词元；</li>
<li>元数据：提供一些高级信息，例如目标受众、数据类型、语言风格等；</li>
<li>前缀调整：Prefix Tuning，在模型中预置可训练向量，放在输入层前面，作用有些类似于提示词；</li>
<li>输出缩放：在模型中预置可训练向量，对模块的输出进行缩放，例如 IA3；</li>
</ul>
<h2 id="%E5%BE%AE%E8%B0%83" tabindex="-1" id="微调">微调</h2>
<p>预训练的模型在出厂发布前，一般会针对特定的使用场景进行一次全量微调。所以常规的微调一般只需在出厂模型的基础上，使用特定数据，进行局部参数的高效微调。如果训练数据很大且类型不够多样，进行全量微调有一定的风险，因为有可能导致模型原本学习到的能力的降低甚至遗忘。</p>
<h3 id="%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" tabindex="-1" id="使用场景">使用场景</h3>
<p>微调主要有以下几种使用场景：</p>
<ul>
<li>对话风格：回答的语气、用词等，塑造某种人设或情感风格，让模型的回答具备个性化的特点；</li>
<li>知识灌注：让模型学习一些垂直领域的基本常识和概念，这样有助力提升其推理能力；细节知识可由 RAG 辅助；</li>
<li>推理能力：通过提供特定领域的推理示例，提升模型处理特定领域复杂任务的推理能力；</li>
<li>Agent 能力：让模型能够更高的和其他外部工具进行配合；知道有哪些工具可以用，在什么场景下使用等等；</li>
</ul>
<blockquote>
<p>对于微调来说，最重要的不是方法或工具，最重要的是如何准备高质量的数据；</p>
</blockquote>
<h3 id="%E4%BA%91%E6%9C%8D%E5%8A%A1" tabindex="-1" id="云服务">云服务</h3>
<p>一些微调模型的平台</p>
<ul>
<li>Colab</li>
<li>AutoDL，国内智谱华章运营，性价比更高；</li>
</ul>
<h3 id="%E5%BE%AE%E8%B0%83%E6%A1%86%E6%9E%B6" tabindex="-1" id="微调框架">微调框架</h3>
<p>一些开源的微调框架：</p>
<table>
<thead>
<tr>
<th>框架</th>
<th>特点</th>
<th>GitHub / 文档</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LLaMA-Factory</strong></td>
<td>支持 100+ 开源模型（Qwen、Llama3、Gemma 等），集成 LoRA/QLoRA/DPO/PPO，带 Web UI（LlamaBoard），中文文档完善</td>
<td><a target="_blank" rel="noopener" href="https://github.com/hiyouga/LLaMA-Factory">GitHub</a> | <a target="_blank" rel="noopener" href="https://llamafactory.readthedocs.io/zh-cn/latest/">文档</a></td>
</tr>
<tr>
<td><strong>Hugging Face Transformers + PEFT</strong></td>
<td>行业标准组合，生态最大，支持所有主流模型，配合 <code>trl</code> 可做 DPO/SFT</td>
<td><a target="_blank" rel="noopener" href="https://huggingface.co/docs">HF 官网</a></td>
</tr>
<tr>
<td><strong>Unsloth</strong></td>
<td>单机单卡，训练加速神器，显存降低 60%+，速度提升 2 倍，精度无损，兼容 HF 生态；</td>
<td><a target="_blank" rel="noopener" href="https://github.com/unslothai/unsloth">GitHub</a></td>
</tr>
<tr>
<td><strong>SWIFT（ModelScope）</strong></td>
<td>阿里系开源框架，支持 300+ LLM + 50+ 多模态模型，覆盖训练→推理→评测全链路</td>
<td><a target="_blank" rel="noopener" href="https://github.com/modelscope/swift">GitHub</a></td>
</tr>
<tr>
<td><strong>XTuner</strong></td>
<td>中文社区活跃，与 LMDeploy/OpenCompass 深度集成，适合国产模型（如 InternLM）微调</td>
<td><a target="_blank" rel="noopener" href="https://github.com/InternLM/xtuner">GitHub</a></td>
</tr>
<tr>
<td><strong>Firefly</strong></td>
<td>配置文件驱动，支持预训练/SFT/DPO，小白也能快速上手</td>
<td><a target="_blank" rel="noopener" href="https://github.com/yangjianxin1/Firefly">GitHub</a></td>
</tr>
<tr>
<td><strong>Axolotl</strong></td>
<td>高度可配置 YAML 微调框架，适合科研反复实验</td>
<td><a target="_blank" rel="noopener" href="https://github.com/OpenAccess-AI-Collective/axolotl">GitHub</a></td>
</tr>
</tbody>
</table>
<p>大模型性能评估框架：EvalScope，可以从魔搭直接下载数据集进行评测，也是阿里出品。</p>
<p>Linux 和 Win 都能很方便的进行单机单卡微调，但如果是单机多机，则 Linux 支持更好。</p>
<p>微调 Qwen3 系列模型的硬件要求：</p>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202511291123724.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87%E5%BE%AE%E8%B0%83%E6%95%B0%E6%8D%AE%E9%9B%86" tabindex="-1" id="如何准备微调数据集">如何准备微调数据集</h3>
<p>针对不同的业务场景，需要准备不同格式的数据集。例如问答、推理、MCP 这三个场景所需要准备的数据集格式是不同的。大模型工作原理的本质是基于已知的输入，去预测下一个输出。因此真正提交给大模型的数据，也是这种格式。当然，它里面会包含一些特殊字符（类似编程语言中的关键字）标记某段内容的性质。</p>
<blockquote>
<p>每个模型所使用的特殊字符及作用可能不同，详细可参考模型的配置文件 tokenizer_config.json，里面一般会有详细的说明。</p>
</blockquote>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202511291133723.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h4 id="%E9%97%AE%E7%AD%94%E7%B1%BB%E5%9E%8B" tabindex="-1" id="问答类型">问答类型</h4>
<p>假设有以下 JSON 格式的训练数据集</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;instruction&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你是一名乐于助人的助手&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;input&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你好&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;output&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你好，请问有什么可以帮助您&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>它实际输入给模型的数据会转换成如下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 问答类型的训练，模型的预期返回内容是文本格式</span><br>&lt;|im_start|&gt;system<br>你是一名乐于助人的助手&lt;|im_end|&gt;<br>&lt;|im_start|&gt;user<br>你好&lt;|im_end|&gt;<br>&lt;|im_start|&gt;assistant<br>你好，请问有什么可以帮助您&lt;|im_end|&gt;<br></code></pre></td></tr></table></figure>
<h4 id="mcp-%E7%B1%BB%E5%9E%8B" tabindex="-1" id="MCP-类型">MCP 类型</h4>
<p>MCP 工具类型的训练，模型的预期返回内容是 JSON 格式，以下是训练数据的示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;instruction&quot;</span>: <span class="hljs-string">&quot;你是一名乐于助人的助手。当用户查询天气的时候，请调用 get_weather 函数进行天气查询&quot;</span>,<br>    <span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;你好，请帮我查询深圳的天气&quot;</span>,<br>    <span class="hljs-string">&quot;output&quot;</span>: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;shenzhen&quot;</span>&#125;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>经过微调框架对以上 JSON 进行格式转换后，实际输入模型的数据内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;|im_start|&gt;system<br>你是一名助人为乐的助手。当用户查询天气的时候，请调用 get_weather 函数进行天气信息查询。<br><br><span class="hljs-comment"># Tools</span><br>You may call one or more <span class="hljs-built_in">functions</span> to assist with the user query.<br>You are provided with <span class="hljs-keyword">function</span> signatures within &lt;tools&gt;&lt;/tools&gt; XML tags:<br><br>&lt;tools&gt;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;查询指定城市的天气信息&quot;</span>, <span class="hljs-string">&quot;parameters&quot;</span>:<br>&#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>, <span class="hljs-string">&quot;properties&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>:<br><span class="hljs-string">&quot;要查询天气的城市名称&quot;</span>&#125;&#125;, <span class="hljs-string">&quot;required&quot;</span>: [<span class="hljs-string">&quot;location&quot;</span>]&#125;&#125;<br>&lt;/tools<br><br>For each <span class="hljs-keyword">function</span> call, <span class="hljs-built_in">return</span> a json object with <span class="hljs-keyword">function</span> name and arguments<br>within &lt;tool_call&gt;&lt;/tool_call&gt; XML tags:<br><br>&lt;tool_call&gt;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>: &lt;function-name&gt;, <span class="hljs-string">&quot;arguments&quot;</span>: &lt;args-json-object&gt;&#125;<br>&lt;/tool_call&gt;<br>&lt;|im_end|&gt;<br><br>&lt;|im_start|&gt;user<br>你好，请帮我查询下北京天气。&lt;|im_end|&gt;<br>&lt;|im_start|&gt;assistant<br>&lt;tool_call&gt;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;北京&quot;</span>&#125;&#125;<br>&lt;/tool_call&gt;&lt;|im_end|&gt;<br></code></pre></td></tr></table></figure>
<h4 id="%E6%80%9D%E7%BB%B4%E9%93%BE%E7%B1%BB%E5%9E%8B" tabindex="-1" id="思维链类型">思维链类型</h4>
<p>训练数据的格式示例，添加了 reasoning_content 字段，用来表示思维过程。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;system&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你是一名乐于助人的助手&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;conversations&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你好，好久不见&quot;</span><span class="hljs-punctuation">&#125;</span>，<br>        <span class="hljs-punctuation">&#123;</span><br>        	<span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assistant&quot;</span><span class="hljs-punctuation">,</span><br>        	<span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;是的，好久不见，近来可好&quot;</span><span class="hljs-punctuation">,</span><br>        	<span class="hljs-attr">&quot;reasoning_content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;好的，用户发来“你好，好久不见”，我需要回应。首先，用户可能希望得到亲切的回复，所以应该使用友好的语气。&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>实际输入模型的数据内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;|im_start|&gt;system<br>你是一名助人为乐的助手。&lt;|im_end|&gt;<br>&lt;|im_start|&gt;user<br>你好，好久不见。&lt;|im_end|&gt;<br>&lt;|im_start|&gt;assistant<br>&lt;think&gt;<br>好的，用户发来“你好，好久不见！”，我需要回应。首先，用户可能希望得到亲切的回应，所以应该用友好的语气。<br>&lt;/think&gt;<br>是的呀，好久不见，最近有什么有趣的事情要和我分享么？&lt;|im_end|&gt;<br></code></pre></td></tr></table></figure>
<h4 id="%E6%80%9D%E8%80%83%E8%BF%87%E7%A8%8B-%2B-%E7%B3%BB%E7%BB%9F%E6%8F%90%E7%A4%BA-%2B-%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8" tabindex="-1" id="思考过程-系统提示-工具调用">思考过程 + 系统提示 + 工具调用</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">&quot;system&quot;</span>: <span class="hljs-string">&quot;你是一名乐于助人的助手&quot;</span>,<br>    <span class="hljs-string">&quot;conversations&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;你好，请帮我查询深圳的天气&quot;</span>&#125;，<br>        &#123;<br>        	<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>,<br>        	<span class="hljs-string">&quot;content&quot;</span>: &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;北京&quot;</span>&#125;&#125;,<br>        	<span class="hljs-string">&quot;reasoning_content&quot;</span>: <span class="hljs-string">&quot;好的，用户问深圳今天的天气，我应该尝试调用工具 get_weather，并将参数设置为北京。&quot;</span><br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure>
<p>转换后输入大模型的内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;|im_start|&gt;system<br>你是一名助人为乐的助手。当用户查询天气的时候，请调用get_weather函数进行天气信息查询。<br><span class="hljs-comment"># Tools</span><br>You may call one or more <span class="hljs-built_in">functions</span> to assist with the user query.<br>You are provided with <span class="hljs-keyword">function</span> signatures within &lt;tools&gt;&lt;/tools&gt; XML tags:<br>&lt;tools&gt;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;查询指定城市的天气信息&quot;</span>, <span class="hljs-string">&quot;parameters&quot;</span>:<br>&#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>, <span class="hljs-string">&quot;properties&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>:<br><span class="hljs-string">&quot;要查询天气的城市名称&quot;</span>&#125;&#125;, <span class="hljs-string">&quot;required&quot;</span>: [<span class="hljs-string">&quot;location&quot;</span>]&#125;&#125;<br>&lt;/tools&gt;<br>For each <span class="hljs-keyword">function</span> call, <span class="hljs-built_in">return</span> a json object with <span class="hljs-keyword">function</span> name and arguments<br>within &lt;tool_call&gt;&lt;/tool_call&gt; XML tags:<br>&lt;tool_call&gt;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>: &lt;function-name&gt;, <span class="hljs-string">&quot;arguments&quot;</span>: &lt;args-json-object&gt;&#125;<br>&lt;/tool_call&gt;<br>&lt;|im_end|&gt;<br>&lt;|im_start|&gt;user<br>你好，请帮我查询下北京天气。&lt;|im_end|&gt;<br>&lt;|im_start|&gt;assistant<br>&lt;think&gt;<br>好的，用户问北京今天的天气，我应该尝试调用工具 get_weather，并将参数设置为北京。<br>&lt;/think&gt;<br>&lt;tool_call&gt;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;北京&quot;</span>&#125;&#125;<br>&lt;/tool_call&gt;&lt;|im_end|&gt;<br></code></pre></td></tr></table></figure>
<h4 id="%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97" tabindex="-1" id="数据清洗">数据清洗</h4>
<p>有很多开源的数据集可以用来辅助微调，但是它们的格式可能各不相同。在微调前，需要使用函数将它们转换成当前模型的提示词模板所规定的格式。有些转换有现成的库可以使用，有些则需要自己编写函数手动转换一下。</p>
<h3 id="%E6%B7%B7%E5%90%88%E6%95%B0%E6%8D%AE%E9%9B%86" tabindex="-1" id="混合数据集">混合数据集</h3>
<p>功能越复杂的模型，如果微调的数据集不匹配，越有可能在微调后失去原本的复杂能力。如果想要保持模型原本的能力，则在准备数据集，要特别小心。在准备新的领域知识的数据时，也要保留很大一部分旧有的训练数据集。这样才能够避免能力的遗忘。</p>
<p>不同的数据集的条数可能存在很大的差别，在创建混合数据集则，需要根据实际的业务场景设置不同的配比。例如对于问答类的模型，可以安排 25% 的推理，75% 的对话等等。</p>
<h3 id="%E9%85%8D%E5%A5%97%E5%B7%A5%E5%85%B7" tabindex="-1" id="配套工具">配套工具</h3>
<ul>
<li>unsloth：适合单机单卡；</li>
<li>vLLM 或 Ollama：用来部署微调后的模型；其他选择有 TensorRT</li>
<li>EvalScope：用来评估微调效果；</li>
<li>wandb：用来实时收集训练数据，观测微调过程中的各效指标变化；</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Qwen3-8B-unsloth-bnb-4bit 假设使用 T4 显卡（16G 显存）进行推理时的启动命令</span><br><span class="hljs-comment"># 此处设置了上下文长度为 32768，默认是 40960，会造成显存不足，如果有 24G 以上显存，则可以不用担心</span><br>vllm serve ./Qwen3-8B-unsloth-bnb-4bit --enable-auto-tool-choice --tool-call-parse hermes --max-model-len 32768<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 模型参数</span><br>generation_config=&#123;<br>    <span class="hljs-string">&#x27;max_tokens&#x27;</span>: <span class="hljs-number">30000</span>, <span class="hljs-comment"># 最大生成token数</span><br>    <span class="hljs-string">&#x27;temperature&#x27;</span>: <span class="hljs-number">0.6</span>, <span class="hljs-comment"># 采样温度</span><br>    <span class="hljs-string">&#x27;top_p&#x27;</span>: <span class="hljs-number">0.95</span>, <span class="hljs-comment"># top-p 采样，将候选词按概率从高到低进行排名，然后选前 n 个候选词，这 n 个候选词的概率合计 &lt;= 0.95。该策略比 top_k 更灵活一些，即能在确定性高的场景中避免一些噪声词，也能在开放答案的场景中增加一些候选词</span><br>    <span class="hljs-string">&#x27;top_k&#x27;</span>: <span class="hljs-number">20</span>, <span class="hljs-comment"># top-k 采样，固定选择前 k 个候选词</span><br>    <span class="hljs-string">&#x27;n&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-comment"># 每个请求产生的回复数量</span><br>&#125;,<br></code></pre></td></tr></table></figure>
<h3 id="%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0" tabindex="-1" id="模型评估">模型评估</h3>
<p>使用 evalscope 及数据集进行评测</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> evalscope <span class="hljs-keyword">import</span> TaskConfig, run_task<br><br>task_cfg = TaskConfig(<br>    model=<span class="hljs-string">&quot;./Qwen3-8B-unsloth-bnb-4bit&quot;</span>,<br>    api_url=<span class="hljs-string">&quot;http://127.0.0.1:8000/v1/chat/completions&quot;</span>,<br>    eval_type=<span class="hljs-string">&quot;openai_api&quot;</span>,<br>    datasets=[<br>        <span class="hljs-string">&quot;data_collection&quot;</span>,<br>    ],<br>    dataset_args=&#123;<br>        <span class="hljs-string">&quot;data_collection&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;dataset_id&quot;</span>: <span class="hljs-string">&quot;evalscope/Qwen3-Test-Collection&quot;</span>,<br>            <span class="hljs-string">&quot;filters&quot;</span>: &#123;<span class="hljs-string">&quot;remove_until&quot;</span>: <span class="hljs-string">&quot;&lt;/think&gt;&quot;</span>&#125;,  <span class="hljs-comment"># 过滤掉思考的内容</span><br>        &#125;<br>    &#125;,<br>    eval_batch_size=<span class="hljs-number">8</span>,<br>    generation_config=&#123;<br>        <span class="hljs-string">&quot;max_tokens&quot;</span>: <span class="hljs-number">2048</span>,  <span class="hljs-comment"># 最大生成 token 数，建议设置为较大值避免输出截断</span><br>        <span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">0.6</span>,  <span class="hljs-comment"># 采样温度 (qwen 报告推荐值)</span><br>        <span class="hljs-string">&quot;top_p&quot;</span>: <span class="hljs-number">0.95</span>,  <span class="hljs-comment"># top-p采样 (qwen 报告推荐值)</span><br>        <span class="hljs-string">&quot;top_k&quot;</span>: <span class="hljs-number">20</span>,  <span class="hljs-comment"># top-k采样 (qwen 报告推荐值)</span><br>        <span class="hljs-string">&quot;n&quot;</span>: <span class="hljs-number">1</span>,  <span class="hljs-comment"># 每个请求产生的回复数量</span><br>    &#125;,<br>    timeout=<span class="hljs-number">60000</span>,  <span class="hljs-comment"># 超时时间</span><br>    stream=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 是否使用流式输出</span><br>    limit=<span class="hljs-number">200</span>,  <span class="hljs-comment"># 设置为 200 条数据进行测试</span><br>)<br><br>run_task(task_cfg=task_cfg)<br></code></pre></td></tr></table></figure>
<h3 id="mcp-%E5%BE%AE%E8%B0%83" tabindex="-1" id="MCP-微调">MCP 微调</h3>
<blockquote>
<p>问：调用 MCP 的多轮对话场景如何进行微调训练？</p>
<p>答：直接将工具调用和回复做为数据的一部分，转换成标志符号，模型可以识别。此时数据中会出现多个 assistant 标记；</p>
</blockquote>
<p>串联调用示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;messages&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;北京明天适合出门吗？&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: null,<br>      <span class="hljs-string">&quot;tool_calls&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;call_1&quot;</span>,<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br>          <span class="hljs-string">&quot;function&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>,<br>            <span class="hljs-string">&quot;arguments&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;location\&quot;: \&quot;北京\&quot;, \&quot;date\&quot;: \&quot;明天\&quot;&#125;&quot;</span><br>          &#125;<br>        &#125;<br>      ]<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;tool&quot;</span>,<br>      <span class="hljs-string">&quot;tool_call_id&quot;</span>: <span class="hljs-string">&quot;call_1&quot;</span>,<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;temperature\&quot;: 5, \&quot;condition\&quot;: \&quot;晴\&quot;, \&quot;precipitation\&quot;: 0&#125;&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: null,<br>      <span class="hljs-string">&quot;tool_calls&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;call_2&quot;</span>,<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br>          <span class="hljs-string">&quot;function&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;assess_outdoor_suitability&quot;</span>,<br>            <span class="hljs-string">&quot;arguments&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;temperature\&quot;: 5, \&quot;condition\&quot;: \&quot;晴\&quot;, \&quot;precipitation\&quot;: 0&#125;&quot;</span><br>          &#125;<br>        &#125;<br>      ]<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;tool&quot;</span>,<br>      <span class="hljs-string">&quot;tool_call_id&quot;</span>: <span class="hljs-string">&quot;call_2&quot;</span>,<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;assess_outdoor_suitability&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;suitable\&quot;: true, \&quot;reason\&quot;: \&quot;天气晴朗，无降水，适合户外活动\&quot;&#125;&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;北京明天天气晴朗，气温5°C，无降水，非常适合出门！&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>
<p>并联调用示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>  <span class="hljs-string">&quot;messages&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;查一下北京明天的天气和空气质量。&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: null,<br>      <span class="hljs-string">&quot;tool_calls&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;call_1&quot;</span>,<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br>          <span class="hljs-string">&quot;function&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>,<br>            <span class="hljs-string">&quot;arguments&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;location\&quot;: \&quot;北京\&quot;, \&quot;date\&quot;: \&quot;明天\&quot;&#125;&quot;</span><br>          &#125;<br>        &#125;,<br>        &#123;<br>          <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;call_2&quot;</span>,<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br>          <span class="hljs-string">&quot;function&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_air_quality&quot;</span>,<br>            <span class="hljs-string">&quot;arguments&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;city\&quot;: \&quot;北京\&quot;&#125;&quot;</span><br>          &#125;<br>        &#125;<br>      ]<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;tool&quot;</span>,<br>      <span class="hljs-string">&quot;tool_call_id&quot;</span>: <span class="hljs-string">&quot;call_1&quot;</span>,<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;temperature\&quot;: 5, \&quot;condition\&quot;: \&quot;晴\&quot;&#125;&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;tool&quot;</span>,<br>      <span class="hljs-string">&quot;tool_call_id&quot;</span>: <span class="hljs-string">&quot;call_2&quot;</span>,<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_air_quality&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;&#123;\&quot;aqi\&quot;: 75, \&quot;level\&quot;: \&quot;良\&quot;&#125;&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>,<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;北京明天天气晴朗，气温5°C；空气质量良好（AQI 75），适合外出。&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="%E8%83%BD%E5%8A%9B%E9%81%97%E5%BF%98" tabindex="-1" id="能力遗忘">能力遗忘</h3>
<p>模型在出厂的时候，一般已经针对通用任务调整到了最佳状态。考虑到模型参数的限制，一般很难再让模型在记住旧知识的前提，学习新的知识，相当于模型参数的表达能力已经处于一个饱和的状态了。此时再使用垂直领域的数据进行微调，通常多多少少会造成原有能力的遗忘。微调训练所使用的垂直领域数据集越大，遗忘发生的可能性越高。总的来说，需要进行权衡和取舍。</p>
<h2 id="%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B-1" tabindex="-1" id="提示工程-2">提示工程</h2>
<p>提示一般由以下三部分组成：</p>
<ul>
<li>描述：详细描述任务目标、任务要求、输入格式、输出格式，用于向大模型解释清楚任务；</li>
<li>示例：为模型提供示范，进一步对齐上一步的描述；</li>
<li>输入：待解决的问题；</li>
</ul>
<p>一些提示词技术：</p>
<ul>
<li>少样本提示</li>
<li>思维链提示</li>
<li>自洽性提示：要求模型生成多个答案，然后再从中选择最佳答案；</li>
<li>思维树提示：要求模型生成多个解决问题的步骤或方法，然后再对这些方法进行评估；</li>
</ul>
<h3 id="cot-%E6%80%9D%E7%BB%B4%E9%93%BE" tabindex="-1" id="CoT-思维链">CoT 思维链</h3>
<p>Chain of Thought，思维链；它其实是一种提示词技巧，引导模型将一个复杂的大任务，拆分成多个小任务进行处理。它有几种实现方式：</p>
<ul>
<li>零样本：在提出问题后，仅在最后附加一句咒语：Let’s think step by step。这句咒语会激发模型调用过往训练过程中见到过的推理样本（例如解数学题等），模型会按照习得的推理模式进行思考；</li>
<li>小样本：在提出问题前，附加 1-2 个示例，引导模型参照示例进行处理；每个示例包括：问题、推理过程、最终答案等内容；</li>
<li>自洽性：对小样本的进一步改进。相当于在示例中，罗列出多种解题方法，让模型参考该方法，从多个角度寻找答案，最终综合不同结果，选择最可能正确的那个答案；</li>
<li>复杂思维树：ToT，Tree of Thought，对自洽性的进一步改进。拆分多个步骤，每个步骤罗列多种可能方案，评估各方案，选择最可能正确的那个，一步一步的深入；相当于模拟人类的思考过程；</li>
</ul>
<h3 id="react-%E6%8E%A8%E7%90%86%26%E8%A1%8C%E5%8A%A8" tabindex="-1" id="ReAct-推理-行动">ReAct 推理&amp;行动</h3>
<p>Reasoning &amp; Action，推理+行动，它也是一种提示词工程（技巧）。相比 CoT，它引入了动作，并且更加系统化或者说结构化，是一种更加高级的提示词策略。它遵循一个固定的范式，即采取动作前，先基于信息进行思考，判断自己下一步应该采取哪个动作。执行动作后，根据得到的信息，再次进行这个“思考-&gt;行动&quot;的循环，直至思考结果为采取给出最终答案的动作，循环结束。</p>
<blockquote>
<p>给出最终答案也可以视为一个特定类型的动作。其他动作则由预先定义好的各种函数组成，封装成工具 tool，以便供框架进行调用。</p>
</blockquote>
<p>示例如下：</p>
<p>问题：爱因斯坦获得诺贝尔奖的年份比他发表狭义相对论晚多少年？</p>
<ul>
<li><strong>Thought:</strong> 我需要先找出爱因斯坦发表狭义相对论的年份，然后再找出他获得诺贝尔奖的年份，最后计算两者之差。</li>
<li><strong>Action:</strong> SearchEngine(query=“爱因斯坦 狭义相对论 发表年份”)</li>
<li><strong>Observation:</strong> 爱因斯坦于1905年发表狭义相对论。</li>
<li><strong>Thought:</strong> 现在我知道了发表狭义相对论的年份是1905年。接下来，我需要查找他获得诺贝尔奖的年份。</li>
<li><strong>Action:</strong> SearchEngine(query=“爱因斯坦 获得诺贝尔奖 年份”)</li>
<li><strong>Observation:</strong> 爱因斯坦于1921年获得诺贝尔物理学奖。</li>
<li><strong>Thought:</strong> 现在我有了两个年份：1905年和1921年。我可以计算它们之间的差值了。</li>
<li><strong>Action:</strong> PythonInterpreter(code=“1921 - 1905”)</li>
<li><strong>Observation:</strong> 16</li>
<li><strong>Final Answer:</strong> 爱因斯坦获得诺贝尔奖的年份比他发表狭义相对论晚了16年。</li>
</ul>
<h1 id="%E5%A4%9A%E6%A8%A1%E6%80%81-rag" tabindex="-1">多模态 RAG</h1>
<p>常见步骤：</p>
<ul>
<li>PDF 解析</li>
<li>提取多模态信息</li>
<li>转 Markdown：能够保留语义结构，也方便后续提取；</li>
<li>文档切分</li>
<li>混合检索</li>
</ul>
<blockquote>
<p>RAG 的几种类型：</p>
<ul>
<li>GraphRAG：会生成知识图谱，适合复杂领域的知识；</li>
<li>AgenticRAG：Agent 和 RAG 的结合；</li>
<li>多模态RAG：能够同时处理文本、图像、视频、音频、表格、公式等不同格式的输入和输出；</li>
</ul>
</blockquote>
<h2 id="%E6%96%87%E6%A1%A3%E8%A7%A3%E6%9E%90" tabindex="-1" id="文档解析">文档解析</h2>
<p>涉及的工作</p>
<ul>
<li>分析版面：使用专门的 OCR 或版面分析模型</li>
<li>提取层次结构；</li>
<li>提取图表；</li>
<li>融合多模态信息进行建模；</li>
</ul>
<p>关于图片的处理，不仅仅是提取图片，还需要分析图片中的内容，这个比较有挑战；主要有两种处理方案：</p>
<ul>
<li>OCR：擅长识别光学字符，能够很好的提取文字（手写或打印都可以），但无法实现图片的语义理解；</li>
<li>VLM 模型：能够很好的实现图片内容的理解，但是需要调用大模型，成本比较高；</li>
</ul>
<p>几种 PDF 解析方法：</p>
<p>方法一：基于结构的完整重建</p>
<ul>
<li>分析版面</li>
<li>分离元素；</li>
<li>内容识别和筛选；</li>
<li>格式转换：转成 Markdown，以便保留结构；</li>
</ul>
<p>优点：结构完整，适合学术论文、报告、书籍等结构化程度高的文档；</p>
<p>方法二：图文切分+并行存储</p>
<ul>
<li>PDF 按页面、段落、图片、表格进行切分；</li>
<li>文本直接转向量；</li>
<li>图片转存为图片向量（使用专用模型，如 CLIP、BLIP2等）</li>
<li>检索时也分开并行检索；</li>
<li>最终融合输出；</li>
</ul>
<p>方法三：提取知识形成图谱</p>
<ul>
<li>解析 PDF 后，使用单独的模型抽取知识单元，以便识别关键的实体、关系和事件；</li>
<li>将知识单元和上下文存入向量库，方便后续的语义化和结构化检索；</li>
</ul>
<h2 id="%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9E%8B" tabindex="-1" id="相关模型">相关模型</h2>
<p>一些热门的 OCR 模型</p>
<ul>
<li>dots.orc：小红书出品，端到端的模型，使用 VLT 架构（Vision Language Transformer），将检测、识别、建模等工作合并在一个模型中，减少了不同模块之间的对齐误差。模型只有 1.7B 的参数规模，非常轻量。</li>
<li>olmOCR：最大限度保留原文档内容的顺序性，但无法提取图片的语义，需要额外的 VLM 模型协助。</li>
<li>PaddleOCR：模型生态丰富，广泛使用。模型非常轻量，可在 CPU 上面运行。识别文本能力很强，但复杂图表、跨页关系需要额外处理；</li>
</ul>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202512012045787.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>一些热门的 VLM 模型</p>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202512012120472.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p>多模态 PDF 转 Markdown 模型</p>
<p><img src="https://lhwccw.oss-cn-shenzhen.aliyuncs.com/202512012123649.png" srcset="/img/loading.gif" lazyload alt="image-20251201212330437"></p>
<h2 id="agenticrag" tabindex="-1" id="AgenticRAG">AgenticRAG</h2>
<p>传统 RAG 的响应逻辑比较单一，检索 + 生成；但如果是一个复杂的问题，则可能涉及多步推理，例如：“xxx 名星的母校的建校年份是什么时候”。AgenticRAG 是一种新的 RAG 范式，它支持多步推理，能够先问问题拆分成多个小任务，再逐个寻找信息，最终再拼接成完整的答案。</p>
<p>上下文工程：</p>
<ul>
<li>检索；</li>
<li>内容护栏：判断相关性</li>
<li>重写：若相关性不高，或者没有检索到内容，则可能需要重写问题。</li>
<li>生成答案；</li>
</ul>
<p>以上工作可以编写多个函数完成，然后注册为 LangGraph 的节点，组装成 Agent 及工作流。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" class="category-chain-item">计算机</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="print-no-link">#人工智能</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>LangChain 大模型应用开发</div>
      <div>https://ccw1078.github.io/2025/11/08/LangChain 大模型应用开发/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>ccw</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年11月8日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/26/%E5%85%B1%E6%9C%89%E4%BA%A7%E6%9D%83%E6%88%BF%E7%9A%84%E6%8E%A2%E7%B4%A2/" title="共有产权房的探索">
                        <span class="hidden-mobile">共有产权房的探索</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
